


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for poppy/dns/rackspace/services.py: 88%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>poppy/dns/rackspace/services.py</b> :
            <span class="pc_cov">88%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            424 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">379 run</span>
            <span class="mis shortkey_m button_toggle_mis">45 missing</span>
            <span class="exc shortkey_x button_toggle_exc">2 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">25 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="stm run hide_run"><a href="#n16">16</a></p>
<p id="n17" class="stm run hide_run"><a href="#n17">17</a></p>
<p id="n18" class="stm run hide_run"><a href="#n18">18</a></p>
<p id="n19" class="stm run hide_run"><a href="#n19">19</a></p>
<p id="n20" class="exc"><a href="#n20">20</a></p>
<p id="n21" class="exc"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="stm run hide_run"><a href="#n23">23</a></p>
<p id="n24" class="stm run hide_run"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="stm run hide_run"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="stm run hide_run"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="stm run hide_run"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="stm run hide_run"><a href="#n33">33</a></p>
<p id="n34" class="stm run hide_run"><a href="#n34">34</a></p>
<p id="n35" class="pln"><a href="#n35">35</a></p>
<p id="n36" class="stm run hide_run"><a href="#n36">36</a></p>
<p id="n37" class="pln"><a href="#n37">37</a></p>
<p id="n38" class="stm run hide_run"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="pln"><a href="#n40">40</a></p>
<p id="n41" class="pln"><a href="#n41">41</a></p>
<p id="n42" class="pln"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="stm run hide_run"><a href="#n45">45</a></p>
<p id="n46" class="stm run hide_run"><a href="#n46">46</a></p>
<p id="n47" class="stm run hide_run"><a href="#n47">47</a></p>
<p id="n48" class="stm run hide_run"><a href="#n48">48</a></p>
<p id="n49" class="stm run hide_run"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="pln"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="stm run hide_run"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="stm run hide_run"><a href="#n55">55</a></p>
<p id="n56" class="pln"><a href="#n56">56</a></p>
<p id="n57" class="pln"><a href="#n57">57</a></p>
<p id="n58" class="pln"><a href="#n58">58</a></p>
<p id="n59" class="pln"><a href="#n59">59</a></p>
<p id="n60" class="pln"><a href="#n60">60</a></p>
<p id="n61" class="pln"><a href="#n61">61</a></p>
<p id="n62" class="stm run hide_run"><a href="#n62">62</a></p>
<p id="n63" class="stm run hide_run"><a href="#n63">63</a></p>
<p id="n64" class="stm run hide_run"><a href="#n64">64</a></p>
<p id="n65" class="pln"><a href="#n65">65</a></p>
<p id="n66" class="pln"><a href="#n66">66</a></p>
<p id="n67" class="stm run hide_run"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="stm run hide_run"><a href="#n69">69</a></p>
<p id="n70" class="pln"><a href="#n70">70</a></p>
<p id="n71" class="stm run hide_run"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="stm run hide_run"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="stm run hide_run"><a href="#n75">75</a></p>
<p id="n76" class="pln"><a href="#n76">76</a></p>
<p id="n77" class="stm run hide_run"><a href="#n77">77</a></p>
<p id="n78" class="stm run hide_run"><a href="#n78">78</a></p>
<p id="n79" class="pln"><a href="#n79">79</a></p>
<p id="n80" class="stm run hide_run"><a href="#n80">80</a></p>
<p id="n81" class="stm run hide_run"><a href="#n81">81</a></p>
<p id="n82" class="stm run hide_run"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="stm run hide_run"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="stm run hide_run"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="stm run hide_run"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="pln"><a href="#n91">91</a></p>
<p id="n92" class="pln"><a href="#n92">92</a></p>
<p id="n93" class="pln"><a href="#n93">93</a></p>
<p id="n94" class="stm run hide_run"><a href="#n94">94</a></p>
<p id="n95" class="stm par run hide_run"><a href="#n95">95</a></p>
<p id="n96" class="stm mis"><a href="#n96">96</a></p>
<p id="n97" class="pln"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="stm run hide_run"><a href="#n99">99</a></p>
<p id="n100" class="stm run hide_run"><a href="#n100">100</a></p>
<p id="n101" class="pln"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="pln"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="pln"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="pln"><a href="#n108">108</a></p>
<p id="n109" class="stm run hide_run"><a href="#n109">109</a></p>
<p id="n110" class="pln"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="pln"><a href="#n112">112</a></p>
<p id="n113" class="stm run hide_run"><a href="#n113">113</a></p>
<p id="n114" class="pln"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="pln"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="stm run hide_run"><a href="#n118">118</a></p>
<p id="n119" class="pln"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="stm run hide_run"><a href="#n122">122</a></p>
<p id="n123" class="pln"><a href="#n123">123</a></p>
<p id="n124" class="stm run hide_run"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="stm run hide_run"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="pln"><a href="#n129">129</a></p>
<p id="n130" class="stm run hide_run"><a href="#n130">130</a></p>
<p id="n131" class="pln"><a href="#n131">131</a></p>
<p id="n132" class="pln"><a href="#n132">132</a></p>
<p id="n133" class="pln"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="stm run hide_run"><a href="#n135">135</a></p>
<p id="n136" class="stm run hide_run"><a href="#n136">136</a></p>
<p id="n137" class="stm run hide_run"><a href="#n137">137</a></p>
<p id="n138" class="pln"><a href="#n138">138</a></p>
<p id="n139" class="stm run hide_run"><a href="#n139">139</a></p>
<p id="n140" class="pln"><a href="#n140">140</a></p>
<p id="n141" class="stm run hide_run"><a href="#n141">141</a></p>
<p id="n142" class="pln"><a href="#n142">142</a></p>
<p id="n143" class="stm run hide_run"><a href="#n143">143</a></p>
<p id="n144" class="stm run hide_run"><a href="#n144">144</a></p>
<p id="n145" class="stm run hide_run"><a href="#n145">145</a></p>
<p id="n146" class="stm run hide_run"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="stm run hide_run"><a href="#n148">148</a></p>
<p id="n149" class="pln"><a href="#n149">149</a></p>
<p id="n150" class="pln"><a href="#n150">150</a></p>
<p id="n151" class="pln"><a href="#n151">151</a></p>
<p id="n152" class="pln"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm par run hide_run"><a href="#n157">157</a></p>
<p id="n158" class="stm mis"><a href="#n158">158</a></p>
<p id="n159" class="pln"><a href="#n159">159</a></p>
<p id="n160" class="stm run hide_run"><a href="#n160">160</a></p>
<p id="n161" class="pln"><a href="#n161">161</a></p>
<p id="n162" class="stm run hide_run"><a href="#n162">162</a></p>
<p id="n163" class="stm run hide_run"><a href="#n163">163</a></p>
<p id="n164" class="pln"><a href="#n164">164</a></p>
<p id="n165" class="pln"><a href="#n165">165</a></p>
<p id="n166" class="stm par run hide_run"><a href="#n166">166</a></p>
<p id="n167" class="pln"><a href="#n167">167</a></p>
<p id="n168" class="stm mis"><a href="#n168">168</a></p>
<p id="n169" class="pln"><a href="#n169">169</a></p>
<p id="n170" class="stm run hide_run"><a href="#n170">170</a></p>
<p id="n171" class="pln"><a href="#n171">171</a></p>
<p id="n172" class="stm run hide_run"><a href="#n172">172</a></p>
<p id="n173" class="pln"><a href="#n173">173</a></p>
<p id="n174" class="stm run hide_run"><a href="#n174">174</a></p>
<p id="n175" class="stm run hide_run"><a href="#n175">175</a></p>
<p id="n176" class="stm run hide_run"><a href="#n176">176</a></p>
<p id="n177" class="pln"><a href="#n177">177</a></p>
<p id="n178" class="stm run hide_run"><a href="#n178">178</a></p>
<p id="n179" class="pln"><a href="#n179">179</a></p>
<p id="n180" class="stm run hide_run"><a href="#n180">180</a></p>
<p id="n181" class="pln"><a href="#n181">181</a></p>
<p id="n182" class="pln"><a href="#n182">182</a></p>
<p id="n183" class="pln"><a href="#n183">183</a></p>
<p id="n184" class="pln"><a href="#n184">184</a></p>
<p id="n185" class="pln"><a href="#n185">185</a></p>
<p id="n186" class="pln"><a href="#n186">186</a></p>
<p id="n187" class="pln"><a href="#n187">187</a></p>
<p id="n188" class="stm run hide_run"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="pln"><a href="#n191">191</a></p>
<p id="n192" class="stm run hide_run"><a href="#n192">192</a></p>
<p id="n193" class="stm run hide_run"><a href="#n193">193</a></p>
<p id="n194" class="stm run hide_run"><a href="#n194">194</a></p>
<p id="n195" class="stm run hide_run"><a href="#n195">195</a></p>
<p id="n196" class="stm run hide_run"><a href="#n196">196</a></p>
<p id="n197" class="stm run hide_run"><a href="#n197">197</a></p>
<p id="n198" class="stm par run hide_run"><a href="#n198">198</a></p>
<p id="n199" class="stm run hide_run"><a href="#n199">199</a></p>
<p id="n200" class="stm run hide_run"><a href="#n200">200</a></p>
<p id="n201" class="stm run hide_run"><a href="#n201">201</a></p>
<p id="n202" class="pln"><a href="#n202">202</a></p>
<p id="n203" class="stm run hide_run"><a href="#n203">203</a></p>
<p id="n204" class="pln"><a href="#n204">204</a></p>
<p id="n205" class="pln"><a href="#n205">205</a></p>
<p id="n206" class="pln"><a href="#n206">206</a></p>
<p id="n207" class="pln"><a href="#n207">207</a></p>
<p id="n208" class="pln"><a href="#n208">208</a></p>
<p id="n209" class="pln"><a href="#n209">209</a></p>
<p id="n210" class="pln"><a href="#n210">210</a></p>
<p id="n211" class="pln"><a href="#n211">211</a></p>
<p id="n212" class="stm run hide_run"><a href="#n212">212</a></p>
<p id="n213" class="pln"><a href="#n213">213</a></p>
<p id="n214" class="stm par run hide_run"><a href="#n214">214</a></p>
<p id="n215" class="stm mis"><a href="#n215">215</a></p>
<p id="n216" class="stm par run hide_run"><a href="#n216">216</a></p>
<p id="n217" class="stm mis"><a href="#n217">217</a></p>
<p id="n218" class="stm mis"><a href="#n218">218</a></p>
<p id="n219" class="stm mis"><a href="#n219">219</a></p>
<p id="n220" class="stm mis"><a href="#n220">220</a></p>
<p id="n221" class="stm mis"><a href="#n221">221</a></p>
<p id="n222" class="pln"><a href="#n222">222</a></p>
<p id="n223" class="stm mis"><a href="#n223">223</a></p>
<p id="n224" class="pln"><a href="#n224">224</a></p>
<p id="n225" class="stm run hide_run"><a href="#n225">225</a></p>
<p id="n226" class="pln"><a href="#n226">226</a></p>
<p id="n227" class="pln"><a href="#n227">227</a></p>
<p id="n228" class="pln"><a href="#n228">228</a></p>
<p id="n229" class="pln"><a href="#n229">229</a></p>
<p id="n230" class="pln"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="stm mis"><a href="#n232">232</a></p>
<p id="n233" class="pln"><a href="#n233">233</a></p>
<p id="n234" class="stm mis"><a href="#n234">234</a></p>
<p id="n235" class="pln"><a href="#n235">235</a></p>
<p id="n236" class="pln"><a href="#n236">236</a></p>
<p id="n237" class="pln"><a href="#n237">237</a></p>
<p id="n238" class="stm mis"><a href="#n238">238</a></p>
<p id="n239" class="stm mis"><a href="#n239">239</a></p>
<p id="n240" class="stm mis"><a href="#n240">240</a></p>
<p id="n241" class="stm mis"><a href="#n241">241</a></p>
<p id="n242" class="pln"><a href="#n242">242</a></p>
<p id="n243" class="stm run hide_run"><a href="#n243">243</a></p>
<p id="n244" class="pln"><a href="#n244">244</a></p>
<p id="n245" class="pln"><a href="#n245">245</a></p>
<p id="n246" class="pln"><a href="#n246">246</a></p>
<p id="n247" class="pln"><a href="#n247">247</a></p>
<p id="n248" class="pln"><a href="#n248">248</a></p>
<p id="n249" class="pln"><a href="#n249">249</a></p>
<p id="n250" class="stm mis"><a href="#n250">250</a></p>
<p id="n251" class="pln"><a href="#n251">251</a></p>
<p id="n252" class="pln"><a href="#n252">252</a></p>
<p id="n253" class="pln"><a href="#n253">253</a></p>
<p id="n254" class="pln"><a href="#n254">254</a></p>
<p id="n255" class="stm mis"><a href="#n255">255</a></p>
<p id="n256" class="pln"><a href="#n256">256</a></p>
<p id="n257" class="stm run hide_run"><a href="#n257">257</a></p>
<p id="n258" class="pln"><a href="#n258">258</a></p>
<p id="n259" class="pln"><a href="#n259">259</a></p>
<p id="n260" class="pln"><a href="#n260">260</a></p>
<p id="n261" class="pln"><a href="#n261">261</a></p>
<p id="n262" class="pln"><a href="#n262">262</a></p>
<p id="n263" class="pln"><a href="#n263">263</a></p>
<p id="n264" class="stm run hide_run"><a href="#n264">264</a></p>
<p id="n265" class="stm run hide_run"><a href="#n265">265</a></p>
<p id="n266" class="stm run hide_run"><a href="#n266">266</a></p>
<p id="n267" class="stm run hide_run"><a href="#n267">267</a></p>
<p id="n268" class="pln"><a href="#n268">268</a></p>
<p id="n269" class="stm run hide_run"><a href="#n269">269</a></p>
<p id="n270" class="stm run hide_run"><a href="#n270">270</a></p>
<p id="n271" class="stm run hide_run"><a href="#n271">271</a></p>
<p id="n272" class="stm run hide_run"><a href="#n272">272</a></p>
<p id="n273" class="stm run hide_run"><a href="#n273">273</a></p>
<p id="n274" class="pln"><a href="#n274">274</a></p>
<p id="n275" class="pln"><a href="#n275">275</a></p>
<p id="n276" class="stm run hide_run"><a href="#n276">276</a></p>
<p id="n277" class="pln"><a href="#n277">277</a></p>
<p id="n278" class="pln"><a href="#n278">278</a></p>
<p id="n279" class="stm run hide_run"><a href="#n279">279</a></p>
<p id="n280" class="stm run hide_run"><a href="#n280">280</a></p>
<p id="n281" class="stm run hide_run"><a href="#n281">281</a></p>
<p id="n282" class="stm run hide_run"><a href="#n282">282</a></p>
<p id="n283" class="stm run hide_run"><a href="#n283">283</a></p>
<p id="n284" class="pln"><a href="#n284">284</a></p>
<p id="n285" class="pln"><a href="#n285">285</a></p>
<p id="n286" class="pln"><a href="#n286">286</a></p>
<p id="n287" class="stm run hide_run"><a href="#n287">287</a></p>
<p id="n288" class="pln"><a href="#n288">288</a></p>
<p id="n289" class="pln"><a href="#n289">289</a></p>
<p id="n290" class="pln"><a href="#n290">290</a></p>
<p id="n291" class="pln"><a href="#n291">291</a></p>
<p id="n292" class="pln"><a href="#n292">292</a></p>
<p id="n293" class="pln"><a href="#n293">293</a></p>
<p id="n294" class="stm run hide_run"><a href="#n294">294</a></p>
<p id="n295" class="stm run hide_run"><a href="#n295">295</a></p>
<p id="n296" class="stm run hide_run"><a href="#n296">296</a></p>
<p id="n297" class="stm run hide_run"><a href="#n297">297</a></p>
<p id="n298" class="stm run hide_run"><a href="#n298">298</a></p>
<p id="n299" class="pln"><a href="#n299">299</a></p>
<p id="n300" class="pln"><a href="#n300">300</a></p>
<p id="n301" class="pln"><a href="#n301">301</a></p>
<p id="n302" class="stm run hide_run"><a href="#n302">302</a></p>
<p id="n303" class="stm run hide_run"><a href="#n303">303</a></p>
<p id="n304" class="pln"><a href="#n304">304</a></p>
<p id="n305" class="pln"><a href="#n305">305</a></p>
<p id="n306" class="stm run hide_run"><a href="#n306">306</a></p>
<p id="n307" class="stm run hide_run"><a href="#n307">307</a></p>
<p id="n308" class="stm run hide_run"><a href="#n308">308</a></p>
<p id="n309" class="stm run hide_run"><a href="#n309">309</a></p>
<p id="n310" class="stm run hide_run"><a href="#n310">310</a></p>
<p id="n311" class="stm run hide_run"><a href="#n311">311</a></p>
<p id="n312" class="stm run hide_run"><a href="#n312">312</a></p>
<p id="n313" class="pln"><a href="#n313">313</a></p>
<p id="n314" class="pln"><a href="#n314">314</a></p>
<p id="n315" class="pln"><a href="#n315">315</a></p>
<p id="n316" class="pln"><a href="#n316">316</a></p>
<p id="n317" class="pln"><a href="#n317">317</a></p>
<p id="n318" class="pln"><a href="#n318">318</a></p>
<p id="n319" class="pln"><a href="#n319">319</a></p>
<p id="n320" class="pln"><a href="#n320">320</a></p>
<p id="n321" class="pln"><a href="#n321">321</a></p>
<p id="n322" class="pln"><a href="#n322">322</a></p>
<p id="n323" class="pln"><a href="#n323">323</a></p>
<p id="n324" class="pln"><a href="#n324">324</a></p>
<p id="n325" class="pln"><a href="#n325">325</a></p>
<p id="n326" class="pln"><a href="#n326">326</a></p>
<p id="n327" class="stm run hide_run"><a href="#n327">327</a></p>
<p id="n328" class="stm run hide_run"><a href="#n328">328</a></p>
<p id="n329" class="pln"><a href="#n329">329</a></p>
<p id="n330" class="stm run hide_run"><a href="#n330">330</a></p>
<p id="n331" class="stm run hide_run"><a href="#n331">331</a></p>
<p id="n332" class="stm run hide_run"><a href="#n332">332</a></p>
<p id="n333" class="pln"><a href="#n333">333</a></p>
<p id="n334" class="stm run hide_run"><a href="#n334">334</a></p>
<p id="n335" class="pln"><a href="#n335">335</a></p>
<p id="n336" class="pln"><a href="#n336">336</a></p>
<p id="n337" class="pln"><a href="#n337">337</a></p>
<p id="n338" class="pln"><a href="#n338">338</a></p>
<p id="n339" class="pln"><a href="#n339">339</a></p>
<p id="n340" class="pln"><a href="#n340">340</a></p>
<p id="n341" class="stm run hide_run"><a href="#n341">341</a></p>
<p id="n342" class="stm run hide_run"><a href="#n342">342</a></p>
<p id="n343" class="stm run hide_run"><a href="#n343">343</a></p>
<p id="n344" class="pln"><a href="#n344">344</a></p>
<p id="n345" class="stm run hide_run"><a href="#n345">345</a></p>
<p id="n346" class="stm run hide_run"><a href="#n346">346</a></p>
<p id="n347" class="stm run hide_run"><a href="#n347">347</a></p>
<p id="n348" class="stm run hide_run"><a href="#n348">348</a></p>
<p id="n349" class="stm run hide_run"><a href="#n349">349</a></p>
<p id="n350" class="stm run hide_run"><a href="#n350">350</a></p>
<p id="n351" class="stm run hide_run"><a href="#n351">351</a></p>
<p id="n352" class="stm run hide_run"><a href="#n352">352</a></p>
<p id="n353" class="stm run hide_run"><a href="#n353">353</a></p>
<p id="n354" class="pln"><a href="#n354">354</a></p>
<p id="n355" class="pln"><a href="#n355">355</a></p>
<p id="n356" class="stm run hide_run"><a href="#n356">356</a></p>
<p id="n357" class="stm run hide_run"><a href="#n357">357</a></p>
<p id="n358" class="stm run hide_run"><a href="#n358">358</a></p>
<p id="n359" class="stm run hide_run"><a href="#n359">359</a></p>
<p id="n360" class="pln"><a href="#n360">360</a></p>
<p id="n361" class="pln"><a href="#n361">361</a></p>
<p id="n362" class="stm run hide_run"><a href="#n362">362</a></p>
<p id="n363" class="pln"><a href="#n363">363</a></p>
<p id="n364" class="stm run hide_run"><a href="#n364">364</a></p>
<p id="n365" class="stm run hide_run"><a href="#n365">365</a></p>
<p id="n366" class="stm run hide_run"><a href="#n366">366</a></p>
<p id="n367" class="stm run hide_run"><a href="#n367">367</a></p>
<p id="n368" class="pln"><a href="#n368">368</a></p>
<p id="n369" class="stm run hide_run"><a href="#n369">369</a></p>
<p id="n370" class="pln"><a href="#n370">370</a></p>
<p id="n371" class="stm run hide_run"><a href="#n371">371</a></p>
<p id="n372" class="stm run hide_run"><a href="#n372">372</a></p>
<p id="n373" class="pln"><a href="#n373">373</a></p>
<p id="n374" class="pln"><a href="#n374">374</a></p>
<p id="n375" class="stm run hide_run"><a href="#n375">375</a></p>
<p id="n376" class="stm run hide_run"><a href="#n376">376</a></p>
<p id="n377" class="pln"><a href="#n377">377</a></p>
<p id="n378" class="pln"><a href="#n378">378</a></p>
<p id="n379" class="pln"><a href="#n379">379</a></p>
<p id="n380" class="stm run hide_run"><a href="#n380">380</a></p>
<p id="n381" class="pln"><a href="#n381">381</a></p>
<p id="n382" class="stm run hide_run"><a href="#n382">382</a></p>
<p id="n383" class="pln"><a href="#n383">383</a></p>
<p id="n384" class="stm run hide_run"><a href="#n384">384</a></p>
<p id="n385" class="pln"><a href="#n385">385</a></p>
<p id="n386" class="pln"><a href="#n386">386</a></p>
<p id="n387" class="pln"><a href="#n387">387</a></p>
<p id="n388" class="stm run hide_run"><a href="#n388">388</a></p>
<p id="n389" class="stm run hide_run"><a href="#n389">389</a></p>
<p id="n390" class="stm run hide_run"><a href="#n390">390</a></p>
<p id="n391" class="stm run hide_run"><a href="#n391">391</a></p>
<p id="n392" class="stm run hide_run"><a href="#n392">392</a></p>
<p id="n393" class="stm run hide_run"><a href="#n393">393</a></p>
<p id="n394" class="pln"><a href="#n394">394</a></p>
<p id="n395" class="stm run hide_run"><a href="#n395">395</a></p>
<p id="n396" class="stm run hide_run"><a href="#n396">396</a></p>
<p id="n397" class="stm run hide_run"><a href="#n397">397</a></p>
<p id="n398" class="stm run hide_run"><a href="#n398">398</a></p>
<p id="n399" class="pln"><a href="#n399">399</a></p>
<p id="n400" class="pln"><a href="#n400">400</a></p>
<p id="n401" class="stm run hide_run"><a href="#n401">401</a></p>
<p id="n402" class="stm run hide_run"><a href="#n402">402</a></p>
<p id="n403" class="stm run hide_run"><a href="#n403">403</a></p>
<p id="n404" class="stm run hide_run"><a href="#n404">404</a></p>
<p id="n405" class="stm run hide_run"><a href="#n405">405</a></p>
<p id="n406" class="pln"><a href="#n406">406</a></p>
<p id="n407" class="stm run hide_run"><a href="#n407">407</a></p>
<p id="n408" class="stm run hide_run"><a href="#n408">408</a></p>
<p id="n409" class="pln"><a href="#n409">409</a></p>
<p id="n410" class="pln"><a href="#n410">410</a></p>
<p id="n411" class="pln"><a href="#n411">411</a></p>
<p id="n412" class="pln"><a href="#n412">412</a></p>
<p id="n413" class="pln"><a href="#n413">413</a></p>
<p id="n414" class="pln"><a href="#n414">414</a></p>
<p id="n415" class="stm run hide_run"><a href="#n415">415</a></p>
<p id="n416" class="stm run hide_run"><a href="#n416">416</a></p>
<p id="n417" class="stm run hide_run"><a href="#n417">417</a></p>
<p id="n418" class="stm run hide_run"><a href="#n418">418</a></p>
<p id="n419" class="stm run hide_run"><a href="#n419">419</a></p>
<p id="n420" class="stm run hide_run"><a href="#n420">420</a></p>
<p id="n421" class="pln"><a href="#n421">421</a></p>
<p id="n422" class="pln"><a href="#n422">422</a></p>
<p id="n423" class="pln"><a href="#n423">423</a></p>
<p id="n424" class="stm run hide_run"><a href="#n424">424</a></p>
<p id="n425" class="stm run hide_run"><a href="#n425">425</a></p>
<p id="n426" class="pln"><a href="#n426">426</a></p>
<p id="n427" class="pln"><a href="#n427">427</a></p>
<p id="n428" class="stm run hide_run"><a href="#n428">428</a></p>
<p id="n429" class="stm run hide_run"><a href="#n429">429</a></p>
<p id="n430" class="stm run hide_run"><a href="#n430">430</a></p>
<p id="n431" class="stm run hide_run"><a href="#n431">431</a></p>
<p id="n432" class="stm run hide_run"><a href="#n432">432</a></p>
<p id="n433" class="stm run hide_run"><a href="#n433">433</a></p>
<p id="n434" class="pln"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="pln"><a href="#n436">436</a></p>
<p id="n437" class="pln"><a href="#n437">437</a></p>
<p id="n438" class="pln"><a href="#n438">438</a></p>
<p id="n439" class="pln"><a href="#n439">439</a></p>
<p id="n440" class="pln"><a href="#n440">440</a></p>
<p id="n441" class="pln"><a href="#n441">441</a></p>
<p id="n442" class="pln"><a href="#n442">442</a></p>
<p id="n443" class="pln"><a href="#n443">443</a></p>
<p id="n444" class="pln"><a href="#n444">444</a></p>
<p id="n445" class="pln"><a href="#n445">445</a></p>
<p id="n446" class="pln"><a href="#n446">446</a></p>
<p id="n447" class="pln"><a href="#n447">447</a></p>
<p id="n448" class="stm par run hide_run"><a href="#n448">448</a></p>
<p id="n449" class="stm mis"><a href="#n449">449</a></p>
<p id="n450" class="pln"><a href="#n450">450</a></p>
<p id="n451" class="stm run hide_run"><a href="#n451">451</a></p>
<p id="n452" class="stm run hide_run"><a href="#n452">452</a></p>
<p id="n453" class="stm run hide_run"><a href="#n453">453</a></p>
<p id="n454" class="pln"><a href="#n454">454</a></p>
<p id="n455" class="stm run hide_run"><a href="#n455">455</a></p>
<p id="n456" class="pln"><a href="#n456">456</a></p>
<p id="n457" class="pln"><a href="#n457">457</a></p>
<p id="n458" class="pln"><a href="#n458">458</a></p>
<p id="n459" class="stm run hide_run"><a href="#n459">459</a></p>
<p id="n460" class="stm run hide_run"><a href="#n460">460</a></p>
<p id="n461" class="stm run hide_run"><a href="#n461">461</a></p>
<p id="n462" class="stm run hide_run"><a href="#n462">462</a></p>
<p id="n463" class="stm run hide_run"><a href="#n463">463</a></p>
<p id="n464" class="pln"><a href="#n464">464</a></p>
<p id="n465" class="stm run hide_run"><a href="#n465">465</a></p>
<p id="n466" class="stm run hide_run"><a href="#n466">466</a></p>
<p id="n467" class="stm run hide_run"><a href="#n467">467</a></p>
<p id="n468" class="pln"><a href="#n468">468</a></p>
<p id="n469" class="pln"><a href="#n469">469</a></p>
<p id="n470" class="stm run hide_run"><a href="#n470">470</a></p>
<p id="n471" class="stm run hide_run"><a href="#n471">471</a></p>
<p id="n472" class="stm run hide_run"><a href="#n472">472</a></p>
<p id="n473" class="stm run hide_run"><a href="#n473">473</a></p>
<p id="n474" class="stm run hide_run"><a href="#n474">474</a></p>
<p id="n475" class="pln"><a href="#n475">475</a></p>
<p id="n476" class="stm run hide_run"><a href="#n476">476</a></p>
<p id="n477" class="pln"><a href="#n477">477</a></p>
<p id="n478" class="stm run hide_run"><a href="#n478">478</a></p>
<p id="n479" class="stm run hide_run"><a href="#n479">479</a></p>
<p id="n480" class="stm run hide_run"><a href="#n480">480</a></p>
<p id="n481" class="pln"><a href="#n481">481</a></p>
<p id="n482" class="pln"><a href="#n482">482</a></p>
<p id="n483" class="pln"><a href="#n483">483</a></p>
<p id="n484" class="stm mis"><a href="#n484">484</a></p>
<p id="n485" class="stm mis"><a href="#n485">485</a></p>
<p id="n486" class="stm par run hide_run"><a href="#n486">486</a></p>
<p id="n487" class="stm mis"><a href="#n487">487</a></p>
<p id="n488" class="pln"><a href="#n488">488</a></p>
<p id="n489" class="pln"><a href="#n489">489</a></p>
<p id="n490" class="stm mis"><a href="#n490">490</a></p>
<p id="n491" class="pln"><a href="#n491">491</a></p>
<p id="n492" class="stm mis"><a href="#n492">492</a></p>
<p id="n493" class="stm run hide_run"><a href="#n493">493</a></p>
<p id="n494" class="stm run hide_run"><a href="#n494">494</a></p>
<p id="n495" class="stm run hide_run"><a href="#n495">495</a></p>
<p id="n496" class="stm run hide_run"><a href="#n496">496</a></p>
<p id="n497" class="pln"><a href="#n497">497</a></p>
<p id="n498" class="stm par run hide_run"><a href="#n498">498</a></p>
<p id="n499" class="stm mis"><a href="#n499">499</a></p>
<p id="n500" class="pln"><a href="#n500">500</a></p>
<p id="n501" class="pln"><a href="#n501">501</a></p>
<p id="n502" class="stm par run hide_run"><a href="#n502">502</a></p>
<p id="n503" class="stm run hide_run"><a href="#n503">503</a></p>
<p id="n504" class="pln"><a href="#n504">504</a></p>
<p id="n505" class="pln"><a href="#n505">505</a></p>
<p id="n506" class="pln"><a href="#n506">506</a></p>
<p id="n507" class="stm run hide_run"><a href="#n507">507</a></p>
<p id="n508" class="pln"><a href="#n508">508</a></p>
<p id="n509" class="stm mis"><a href="#n509">509</a></p>
<p id="n510" class="pln"><a href="#n510">510</a></p>
<p id="n511" class="stm run hide_run"><a href="#n511">511</a></p>
<p id="n512" class="pln"><a href="#n512">512</a></p>
<p id="n513" class="pln"><a href="#n513">513</a></p>
<p id="n514" class="pln"><a href="#n514">514</a></p>
<p id="n515" class="pln"><a href="#n515">515</a></p>
<p id="n516" class="pln"><a href="#n516">516</a></p>
<p id="n517" class="pln"><a href="#n517">517</a></p>
<p id="n518" class="pln"><a href="#n518">518</a></p>
<p id="n519" class="pln"><a href="#n519">519</a></p>
<p id="n520" class="pln"><a href="#n520">520</a></p>
<p id="n521" class="pln"><a href="#n521">521</a></p>
<p id="n522" class="stm run hide_run"><a href="#n522">522</a></p>
<p id="n523" class="stm run hide_run"><a href="#n523">523</a></p>
<p id="n524" class="stm run hide_run"><a href="#n524">524</a></p>
<p id="n525" class="stm run hide_run"><a href="#n525">525</a></p>
<p id="n526" class="stm run hide_run"><a href="#n526">526</a></p>
<p id="n527" class="stm run hide_run"><a href="#n527">527</a></p>
<p id="n528" class="stm run hide_run"><a href="#n528">528</a></p>
<p id="n529" class="stm run hide_run"><a href="#n529">529</a></p>
<p id="n530" class="stm run hide_run"><a href="#n530">530</a></p>
<p id="n531" class="stm run hide_run"><a href="#n531">531</a></p>
<p id="n532" class="stm run hide_run"><a href="#n532">532</a></p>
<p id="n533" class="stm run hide_run"><a href="#n533">533</a></p>
<p id="n534" class="pln"><a href="#n534">534</a></p>
<p id="n535" class="pln"><a href="#n535">535</a></p>
<p id="n536" class="stm run hide_run"><a href="#n536">536</a></p>
<p id="n537" class="stm run hide_run"><a href="#n537">537</a></p>
<p id="n538" class="stm run hide_run"><a href="#n538">538</a></p>
<p id="n539" class="stm run hide_run"><a href="#n539">539</a></p>
<p id="n540" class="pln"><a href="#n540">540</a></p>
<p id="n541" class="pln"><a href="#n541">541</a></p>
<p id="n542" class="stm run hide_run"><a href="#n542">542</a></p>
<p id="n543" class="stm run hide_run"><a href="#n543">543</a></p>
<p id="n544" class="stm run hide_run"><a href="#n544">544</a></p>
<p id="n545" class="stm run hide_run"><a href="#n545">545</a></p>
<p id="n546" class="stm run hide_run"><a href="#n546">546</a></p>
<p id="n547" class="stm run hide_run"><a href="#n547">547</a></p>
<p id="n548" class="pln"><a href="#n548">548</a></p>
<p id="n549" class="pln"><a href="#n549">549</a></p>
<p id="n550" class="stm run hide_run"><a href="#n550">550</a></p>
<p id="n551" class="stm run hide_run"><a href="#n551">551</a></p>
<p id="n552" class="stm run hide_run"><a href="#n552">552</a></p>
<p id="n553" class="stm run hide_run"><a href="#n553">553</a></p>
<p id="n554" class="stm par run hide_run"><a href="#n554">554</a></p>
<p id="n555" class="pln"><a href="#n555">555</a></p>
<p id="n556" class="pln"><a href="#n556">556</a></p>
<p id="n557" class="pln"><a href="#n557">557</a></p>
<p id="n558" class="pln"><a href="#n558">558</a></p>
<p id="n559" class="stm mis"><a href="#n559">559</a></p>
<p id="n560" class="stm mis"><a href="#n560">560</a></p>
<p id="n561" class="pln"><a href="#n561">561</a></p>
<p id="n562" class="pln"><a href="#n562">562</a></p>
<p id="n563" class="stm run hide_run"><a href="#n563">563</a></p>
<p id="n564" class="stm run hide_run"><a href="#n564">564</a></p>
<p id="n565" class="pln"><a href="#n565">565</a></p>
<p id="n566" class="pln"><a href="#n566">566</a></p>
<p id="n567" class="stm run hide_run"><a href="#n567">567</a></p>
<p id="n568" class="stm run hide_run"><a href="#n568">568</a></p>
<p id="n569" class="stm run hide_run"><a href="#n569">569</a></p>
<p id="n570" class="stm run hide_run"><a href="#n570">570</a></p>
<p id="n571" class="stm run hide_run"><a href="#n571">571</a></p>
<p id="n572" class="stm run hide_run"><a href="#n572">572</a></p>
<p id="n573" class="stm run hide_run"><a href="#n573">573</a></p>
<p id="n574" class="stm run hide_run"><a href="#n574">574</a></p>
<p id="n575" class="pln"><a href="#n575">575</a></p>
<p id="n576" class="pln"><a href="#n576">576</a></p>
<p id="n577" class="pln"><a href="#n577">577</a></p>
<p id="n578" class="pln"><a href="#n578">578</a></p>
<p id="n579" class="pln"><a href="#n579">579</a></p>
<p id="n580" class="stm run hide_run"><a href="#n580">580</a></p>
<p id="n581" class="pln"><a href="#n581">581</a></p>
<p id="n582" class="stm run hide_run"><a href="#n582">582</a></p>
<p id="n583" class="stm run hide_run"><a href="#n583">583</a></p>
<p id="n584" class="pln"><a href="#n584">584</a></p>
<p id="n585" class="pln"><a href="#n585">585</a></p>
<p id="n586" class="stm run hide_run"><a href="#n586">586</a></p>
<p id="n587" class="stm run hide_run"><a href="#n587">587</a></p>
<p id="n588" class="pln"><a href="#n588">588</a></p>
<p id="n589" class="pln"><a href="#n589">589</a></p>
<p id="n590" class="stm run hide_run"><a href="#n590">590</a></p>
<p id="n591" class="stm run hide_run"><a href="#n591">591</a></p>
<p id="n592" class="stm run hide_run"><a href="#n592">592</a></p>
<p id="n593" class="pln"><a href="#n593">593</a></p>
<p id="n594" class="pln"><a href="#n594">594</a></p>
<p id="n595" class="stm run hide_run"><a href="#n595">595</a></p>
<p id="n596" class="stm run hide_run"><a href="#n596">596</a></p>
<p id="n597" class="pln"><a href="#n597">597</a></p>
<p id="n598" class="stm run hide_run"><a href="#n598">598</a></p>
<p id="n599" class="pln"><a href="#n599">599</a></p>
<p id="n600" class="pln"><a href="#n600">600</a></p>
<p id="n601" class="pln"><a href="#n601">601</a></p>
<p id="n602" class="stm run hide_run"><a href="#n602">602</a></p>
<p id="n603" class="pln"><a href="#n603">603</a></p>
<p id="n604" class="pln"><a href="#n604">604</a></p>
<p id="n605" class="pln"><a href="#n605">605</a></p>
<p id="n606" class="stm run hide_run"><a href="#n606">606</a></p>
<p id="n607" class="pln"><a href="#n607">607</a></p>
<p id="n608" class="pln"><a href="#n608">608</a></p>
<p id="n609" class="pln"><a href="#n609">609</a></p>
<p id="n610" class="pln"><a href="#n610">610</a></p>
<p id="n611" class="stm run hide_run"><a href="#n611">611</a></p>
<p id="n612" class="pln"><a href="#n612">612</a></p>
<p id="n613" class="pln"><a href="#n613">613</a></p>
<p id="n614" class="stm run hide_run"><a href="#n614">614</a></p>
<p id="n615" class="stm run hide_run"><a href="#n615">615</a></p>
<p id="n616" class="pln"><a href="#n616">616</a></p>
<p id="n617" class="stm run hide_run"><a href="#n617">617</a></p>
<p id="n618" class="stm run hide_run"><a href="#n618">618</a></p>
<p id="n619" class="stm run hide_run"><a href="#n619">619</a></p>
<p id="n620" class="stm run hide_run"><a href="#n620">620</a></p>
<p id="n621" class="pln"><a href="#n621">621</a></p>
<p id="n622" class="pln"><a href="#n622">622</a></p>
<p id="n623" class="stm run hide_run"><a href="#n623">623</a></p>
<p id="n624" class="stm run hide_run"><a href="#n624">624</a></p>
<p id="n625" class="stm run hide_run"><a href="#n625">625</a></p>
<p id="n626" class="stm run hide_run"><a href="#n626">626</a></p>
<p id="n627" class="pln"><a href="#n627">627</a></p>
<p id="n628" class="pln"><a href="#n628">628</a></p>
<p id="n629" class="pln"><a href="#n629">629</a></p>
<p id="n630" class="stm par run hide_run"><a href="#n630">630</a></p>
<p id="n631" class="stm run hide_run"><a href="#n631">631</a></p>
<p id="n632" class="pln"><a href="#n632">632</a></p>
<p id="n633" class="pln"><a href="#n633">633</a></p>
<p id="n634" class="stm run hide_run"><a href="#n634">634</a></p>
<p id="n635" class="pln"><a href="#n635">635</a></p>
<p id="n636" class="pln"><a href="#n636">636</a></p>
<p id="n637" class="stm run hide_run"><a href="#n637">637</a></p>
<p id="n638" class="stm run hide_run"><a href="#n638">638</a></p>
<p id="n639" class="stm run hide_run"><a href="#n639">639</a></p>
<p id="n640" class="stm run hide_run"><a href="#n640">640</a></p>
<p id="n641" class="stm run hide_run"><a href="#n641">641</a></p>
<p id="n642" class="stm run hide_run"><a href="#n642">642</a></p>
<p id="n643" class="stm run hide_run"><a href="#n643">643</a></p>
<p id="n644" class="stm run hide_run"><a href="#n644">644</a></p>
<p id="n645" class="stm par run hide_run"><a href="#n645">645</a></p>
<p id="n646" class="stm mis"><a href="#n646">646</a></p>
<p id="n647" class="stm run hide_run"><a href="#n647">647</a></p>
<p id="n648" class="pln"><a href="#n648">648</a></p>
<p id="n649" class="stm run hide_run"><a href="#n649">649</a></p>
<p id="n650" class="stm par run hide_run"><a href="#n650">650</a></p>
<p id="n651" class="stm par run hide_run"><a href="#n651">651</a></p>
<p id="n652" class="stm run hide_run"><a href="#n652">652</a></p>
<p id="n653" class="stm run hide_run"><a href="#n653">653</a></p>
<p id="n654" class="stm run hide_run"><a href="#n654">654</a></p>
<p id="n655" class="pln"><a href="#n655">655</a></p>
<p id="n656" class="pln"><a href="#n656">656</a></p>
<p id="n657" class="pln"><a href="#n657">657</a></p>
<p id="n658" class="pln"><a href="#n658">658</a></p>
<p id="n659" class="stm par run hide_run"><a href="#n659">659</a></p>
<p id="n660" class="stm mis"><a href="#n660">660</a></p>
<p id="n661" class="stm run hide_run"><a href="#n661">661</a></p>
<p id="n662" class="stm par run hide_run"><a href="#n662">662</a></p>
<p id="n663" class="pln"><a href="#n663">663</a></p>
<p id="n664" class="stm run hide_run"><a href="#n664">664</a></p>
<p id="n665" class="stm run hide_run"><a href="#n665">665</a></p>
<p id="n666" class="stm par run hide_run"><a href="#n666">666</a></p>
<p id="n667" class="stm run hide_run"><a href="#n667">667</a></p>
<p id="n668" class="stm run hide_run"><a href="#n668">668</a></p>
<p id="n669" class="stm run hide_run"><a href="#n669">669</a></p>
<p id="n670" class="stm run hide_run"><a href="#n670">670</a></p>
<p id="n671" class="pln"><a href="#n671">671</a></p>
<p id="n672" class="pln"><a href="#n672">672</a></p>
<p id="n673" class="pln"><a href="#n673">673</a></p>
<p id="n674" class="pln"><a href="#n674">674</a></p>
<p id="n675" class="stm par run hide_run"><a href="#n675">675</a></p>
<p id="n676" class="stm mis"><a href="#n676">676</a></p>
<p id="n677" class="stm run hide_run"><a href="#n677">677</a></p>
<p id="n678" class="pln"><a href="#n678">678</a></p>
<p id="n679" class="pln"><a href="#n679">679</a></p>
<p id="n680" class="stm run hide_run"><a href="#n680">680</a></p>
<p id="n681" class="stm run hide_run"><a href="#n681">681</a></p>
<p id="n682" class="stm run hide_run"><a href="#n682">682</a></p>
<p id="n683" class="stm run hide_run"><a href="#n683">683</a></p>
<p id="n684" class="stm par run hide_run"><a href="#n684">684</a></p>
<p id="n685" class="pln"><a href="#n685">685</a></p>
<p id="n686" class="pln"><a href="#n686">686</a></p>
<p id="n687" class="pln"><a href="#n687">687</a></p>
<p id="n688" class="pln"><a href="#n688">688</a></p>
<p id="n689" class="stm mis"><a href="#n689">689</a></p>
<p id="n690" class="stm mis"><a href="#n690">690</a></p>
<p id="n691" class="stm par run hide_run"><a href="#n691">691</a></p>
<p id="n692" class="stm mis"><a href="#n692">692</a></p>
<p id="n693" class="pln"><a href="#n693">693</a></p>
<p id="n694" class="pln"><a href="#n694">694</a></p>
<p id="n695" class="pln"><a href="#n695">695</a></p>
<p id="n696" class="pln"><a href="#n696">696</a></p>
<p id="n697" class="pln"><a href="#n697">697</a></p>
<p id="n698" class="pln"><a href="#n698">698</a></p>
<p id="n699" class="pln"><a href="#n699">699</a></p>
<p id="n700" class="stm mis"><a href="#n700">700</a></p>
<p id="n701" class="pln"><a href="#n701">701</a></p>
<p id="n702" class="pln"><a href="#n702">702</a></p>
<p id="n703" class="pln"><a href="#n703">703</a></p>
<p id="n704" class="pln"><a href="#n704">704</a></p>
<p id="n705" class="pln"><a href="#n705">705</a></p>
<p id="n706" class="pln"><a href="#n706">706</a></p>
<p id="n707" class="pln"><a href="#n707">707</a></p>
<p id="n708" class="pln"><a href="#n708">708</a></p>
<p id="n709" class="pln"><a href="#n709">709</a></p>
<p id="n710" class="pln"><a href="#n710">710</a></p>
<p id="n711" class="stm run hide_run"><a href="#n711">711</a></p>
<p id="n712" class="pln"><a href="#n712">712</a></p>
<p id="n713" class="pln"><a href="#n713">713</a></p>
<p id="n714" class="pln"><a href="#n714">714</a></p>
<p id="n715" class="stm run hide_run"><a href="#n715">715</a></p>
<p id="n716" class="stm run hide_run"><a href="#n716">716</a></p>
<p id="n717" class="stm run hide_run"><a href="#n717">717</a></p>
<p id="n718" class="pln"><a href="#n718">718</a></p>
<p id="n719" class="stm run hide_run"><a href="#n719">719</a></p>
<p id="n720" class="pln"><a href="#n720">720</a></p>
<p id="n721" class="stm run hide_run"><a href="#n721">721</a></p>
<p id="n722" class="pln"><a href="#n722">722</a></p>
<p id="n723" class="stm run hide_run"><a href="#n723">723</a></p>
<p id="n724" class="stm run hide_run"><a href="#n724">724</a></p>
<p id="n725" class="stm run hide_run"><a href="#n725">725</a></p>
<p id="n726" class="stm run hide_run"><a href="#n726">726</a></p>
<p id="n727" class="stm run hide_run"><a href="#n727">727</a></p>
<p id="n728" class="stm run hide_run"><a href="#n728">728</a></p>
<p id="n729" class="pln"><a href="#n729">729</a></p>
<p id="n730" class="stm run hide_run"><a href="#n730">730</a></p>
<p id="n731" class="stm run hide_run"><a href="#n731">731</a></p>
<p id="n732" class="pln"><a href="#n732">732</a></p>
<p id="n733" class="stm run hide_run"><a href="#n733">733</a></p>
<p id="n734" class="pln"><a href="#n734">734</a></p>
<p id="n735" class="pln"><a href="#n735">735</a></p>
<p id="n736" class="pln"><a href="#n736">736</a></p>
<p id="n737" class="pln"><a href="#n737">737</a></p>
<p id="n738" class="pln"><a href="#n738">738</a></p>
<p id="n739" class="pln"><a href="#n739">739</a></p>
<p id="n740" class="pln"><a href="#n740">740</a></p>
<p id="n741" class="stm par run hide_run"><a href="#n741">741</a></p>
<p id="n742" class="stm mis"><a href="#n742">742</a></p>
<p id="n743" class="pln"><a href="#n743">743</a></p>
<p id="n744" class="stm run hide_run"><a href="#n744">744</a></p>
<p id="n745" class="pln"><a href="#n745">745</a></p>
<p id="n746" class="stm run hide_run"><a href="#n746">746</a></p>
<p id="n747" class="stm run hide_run"><a href="#n747">747</a></p>
<p id="n748" class="pln"><a href="#n748">748</a></p>
<p id="n749" class="stm run hide_run"><a href="#n749">749</a></p>
<p id="n750" class="pln"><a href="#n750">750</a></p>
<p id="n751" class="stm run hide_run"><a href="#n751">751</a></p>
<p id="n752" class="stm run hide_run"><a href="#n752">752</a></p>
<p id="n753" class="stm run hide_run"><a href="#n753">753</a></p>
<p id="n754" class="stm par run hide_run"><a href="#n754">754</a></p>
<p id="n755" class="stm run hide_run"><a href="#n755">755</a></p>
<p id="n756" class="stm par run hide_run"><a href="#n756">756</a></p>
<p id="n757" class="stm run hide_run"><a href="#n757">757</a></p>
<p id="n758" class="stm run hide_run"><a href="#n758">758</a></p>
<p id="n759" class="stm run hide_run"><a href="#n759">759</a></p>
<p id="n760" class="stm run hide_run"><a href="#n760">760</a></p>
<p id="n761" class="pln"><a href="#n761">761</a></p>
<p id="n762" class="pln"><a href="#n762">762</a></p>
<p id="n763" class="stm run hide_run"><a href="#n763">763</a></p>
<p id="n764" class="stm run hide_run"><a href="#n764">764</a></p>
<p id="n765" class="stm run hide_run"><a href="#n765">765</a></p>
<p id="n766" class="stm run hide_run"><a href="#n766">766</a></p>
<p id="n767" class="pln"><a href="#n767">767</a></p>
<p id="n768" class="pln"><a href="#n768">768</a></p>
<p id="n769" class="pln"><a href="#n769">769</a></p>
<p id="n770" class="stm run hide_run"><a href="#n770">770</a></p>
<p id="n771" class="stm run hide_run"><a href="#n771">771</a></p>
<p id="n772" class="pln"><a href="#n772">772</a></p>
<p id="n773" class="stm mis"><a href="#n773">773</a></p>
<p id="n774" class="pln"><a href="#n774">774</a></p>
<p id="n775" class="stm run hide_run"><a href="#n775">775</a></p>
<p id="n776" class="stm run hide_run"><a href="#n776">776</a></p>
<p id="n777" class="stm run hide_run"><a href="#n777">777</a></p>
<p id="n778" class="stm run hide_run"><a href="#n778">778</a></p>
<p id="n779" class="stm mis"><a href="#n779">779</a></p>
<p id="n780" class="stm mis"><a href="#n780">780</a></p>
<p id="n781" class="stm mis"><a href="#n781">781</a></p>
<p id="n782" class="stm mis"><a href="#n782">782</a></p>
<p id="n783" class="stm mis"><a href="#n783">783</a></p>
<p id="n784" class="stm mis"><a href="#n784">784</a></p>
<p id="n785" class="pln"><a href="#n785">785</a></p>
<p id="n786" class="pln"><a href="#n786">786</a></p>
<p id="n787" class="stm run hide_run"><a href="#n787">787</a></p>
<p id="n788" class="stm run hide_run"><a href="#n788">788</a></p>
<p id="n789" class="stm run hide_run"><a href="#n789">789</a></p>
<p id="n790" class="stm run hide_run"><a href="#n790">790</a></p>
<p id="n791" class="pln"><a href="#n791">791</a></p>
<p id="n792" class="pln"><a href="#n792">792</a></p>
<p id="n793" class="pln"><a href="#n793">793</a></p>
<p id="n794" class="stm run hide_run"><a href="#n794">794</a></p>
<p id="n795" class="stm run hide_run"><a href="#n795">795</a></p>
<p id="n796" class="pln"><a href="#n796">796</a></p>
<p id="n797" class="stm mis"><a href="#n797">797</a></p>
<p id="n798" class="pln"><a href="#n798">798</a></p>
<p id="n799" class="stm run hide_run"><a href="#n799">799</a></p>
<p id="n800" class="stm mis"><a href="#n800">800</a></p>
<p id="n801" class="pln"><a href="#n801">801</a></p>
<p id="n802" class="pln"><a href="#n802">802</a></p>
<p id="n803" class="stm run hide_run"><a href="#n803">803</a></p>
<p id="n804" class="stm run hide_run"><a href="#n804">804</a></p>
<p id="n805" class="stm run hide_run"><a href="#n805">805</a></p>
<p id="n806" class="stm run hide_run"><a href="#n806">806</a></p>
<p id="n807" class="stm run hide_run"><a href="#n807">807</a></p>
<p id="n808" class="stm run hide_run"><a href="#n808">808</a></p>
<p id="n809" class="stm run hide_run"><a href="#n809">809</a></p>
<p id="n810" class="pln"><a href="#n810">810</a></p>
<p id="n811" class="stm run hide_run"><a href="#n811">811</a></p>
<p id="n812" class="stm run hide_run"><a href="#n812">812</a></p>
<p id="n813" class="pln"><a href="#n813">813</a></p>
<p id="n814" class="pln"><a href="#n814">814</a></p>
<p id="n815" class="stm run hide_run"><a href="#n815">815</a></p>
<p id="n816" class="stm run hide_run"><a href="#n816">816</a></p>
<p id="n817" class="stm run hide_run"><a href="#n817">817</a></p>
<p id="n818" class="stm run hide_run"><a href="#n818">818</a></p>
<p id="n819" class="stm run hide_run"><a href="#n819">819</a></p>
<p id="n820" class="stm run hide_run"><a href="#n820">820</a></p>
<p id="n821" class="pln"><a href="#n821">821</a></p>
<p id="n822" class="stm run hide_run"><a href="#n822">822</a></p>
<p id="n823" class="pln"><a href="#n823">823</a></p>
<p id="n824" class="pln"><a href="#n824">824</a></p>
<p id="n825" class="pln"><a href="#n825">825</a></p>
<p id="n826" class="pln"><a href="#n826">826</a></p>
<p id="n827" class="pln"><a href="#n827">827</a></p>
<p id="n828" class="stm run hide_run"><a href="#n828">828</a></p>
<p id="n829" class="stm run hide_run"><a href="#n829">829</a></p>
<p id="n830" class="pln"><a href="#n830">830</a></p>
<p id="n831" class="stm run hide_run"><a href="#n831">831</a></p>

            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com"># Copyright (c) 2014 Rackspace, Inc.</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="com"># Licensed under the Apache License, Version 2.0 (the "License");</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com"># you may not use this file except in compliance with the License.</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com"># You may obtain a copy of the License at</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com">#    http://www.apache.org/licenses/LICENSE-2.0</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com"># Unless required by applicable law or agreed to in writing, software</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># distributed under the License is distributed on an "AS IS" BASIS,</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com"># implied.</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com"># See the License for the specific language governing permissions and</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com"># limitations under the License.</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t16" class="stm run hide_run"><span class="key">import</span> <span class="nam">random</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="stm run hide_run"><span class="key">import</span> <span class="nam">re</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="stm run hide_run"><span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="stm run hide_run">    <span class="nam">set</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="exc"><span class="key">except</span> <span class="nam">NameError</span><span class="op">:</span>  <span class="com"># noqa  pragma: no cover</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="exc">    <span class="key">from</span> <span class="nam">sets</span> <span class="key">import</span> <span class="nam">Set</span> <span class="key">as</span> <span class="nam">set</span>  <span class="com"># noqa  pragma: no cover</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t23" class="stm run hide_run"><span class="key">from</span> <span class="nam">oslo_log</span> <span class="key">import</span> <span class="nam">log</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="stm run hide_run"><span class="key">import</span> <span class="nam">pyrax</span><span class="op">.</span><span class="nam">exceptions</span> <span class="key">as</span> <span class="nam">exc</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t26" class="stm run hide_run"><span class="key">from</span> <span class="nam">poppy</span><span class="op">.</span><span class="nam">dns</span> <span class="key">import</span> <span class="nam">base</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t28" class="stm run hide_run"><span class="nam">LOG</span> <span class="op">=</span> <span class="nam">log</span><span class="op">.</span><span class="nam">getLogger</span><span class="op">(</span><span class="nam">__name__</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t31" class="stm run hide_run"><span class="key">class</span> <span class="nam">ServicesController</span><span class="op">(</span><span class="nam">base</span><span class="op">.</span><span class="nam">ServicesBase</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t33" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">driver</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="stm run hide_run">        <span class="nam">super</span><span class="op">(</span><span class="nam">ServicesController</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">driver</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t35" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t36" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">client</span> <span class="op">=</span> <span class="nam">driver</span><span class="op">.</span><span class="nam">client</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_get_subdomain</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">subdomain_name</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln">        <span class="str">"""Returns a subdomain, if it does not exist, create it</span><span class="strut">&nbsp;</span></p>
<p id="t40" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t41" class="pln"><span class="str">        :param subdomain_name</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="pln"><span class="str">        :return subdomain</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Fetching DNS Record - {0}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">subdomain_name</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="stm run hide_run">            <span class="nam">subdomain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="nam">subdomain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="stm run hide_run">        <span class="key">except</span> <span class="nam">exc</span><span class="op">.</span><span class="nam">NotFound</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm run hide_run">            <span class="nam">subdomain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">create</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln">                <span class="nam">name</span><span class="op">=</span><span class="nam">subdomain_name</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="pln">                <span class="nam">emailAddress</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">email</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln">                <span class="nam">ttl</span><span class="op">=</span><span class="num">900</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="stm run hide_run">        <span class="key">return</span> <span class="nam">subdomain</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t55" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_create_cname_records</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">links</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="pln">        <span class="str">"""Creates a subdomain</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t58" class="pln"><span class="str">        :param links: Access URLS from providers</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="pln"><span class="str">        :return dns_links: Map from provider access URL to DNS access URL</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t62" class="stm run hide_run">        <span class="nam">cdn_domain_name</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">url</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm run hide_run">        <span class="nam">shard_prefix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shard_prefix</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="stm run hide_run">        <span class="nam">num_shards</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">num_shards</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t66" class="pln">        <span class="com"># randomly select a shard</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="stm run hide_run">        <span class="nam">shard_id</span> <span class="op">=</span> <span class="nam">random</span><span class="op">.</span><span class="nam">randint</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="nam">num_shards</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln">        <span class="com"># ex. cdnXXX.altcdn.com</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="stm run hide_run">        <span class="nam">subdomain_name</span> <span class="op">=</span> <span class="str">'{0}{1}.{2}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">shard_prefix</span><span class="op">,</span> <span class="nam">shard_id</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="pln">                                             <span class="nam">cdn_domain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm run hide_run">        <span class="nam">subdomain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_subdomain</span><span class="op">(</span><span class="nam">subdomain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln">        <span class="com"># create CNAME record for adding</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="stm run hide_run">        <span class="nam">cname_records</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t75" class="stm run hide_run">        <span class="nam">dns_links</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm run hide_run">        <span class="nam">shared_ssl_subdomain_name</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="stm run hide_run">        <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">links</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="pln">            <span class="com"># pick out shared ssl domains here</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="stm run hide_run">            <span class="nam">domain_name</span><span class="op">,</span> <span class="nam">certificate</span><span class="op">,</span> <span class="nam">old_operator_url</span> <span class="op">=</span> <span class="nam">link</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="stm run hide_run">            <span class="key">if</span> <span class="nam">certificate</span> <span class="op">==</span> <span class="str">"shared"</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="stm run hide_run">                <span class="nam">shared_ssl_subdomain_name</span> <span class="op">=</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln">                    <span class="str">'.'</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">domain_name</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">'.'</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln">                <span class="com"># perform shared ssl cert logic</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="stm run hide_run">                <span class="nam">name</span> <span class="op">=</span> <span class="nam">domain_name</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln">            <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="stm run hide_run">                <span class="key">if</span> <span class="nam">old_operator_url</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln">                    <span class="com"># verify sub-domain exists</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="stm run hide_run">                    <span class="nam">regex_match</span> <span class="op">=</span> <span class="nam">re</span><span class="op">.</span><span class="nam">match</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln">                        <span class="str">r'^.*('</span> <span class="op">+</span> <span class="nam">shard_prefix</span> <span class="op">+</span> <span class="str">'[0-9]+\.'</span> <span class="op">+</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="pln">                        <span class="nam">re</span><span class="op">.</span><span class="nam">escape</span><span class="op">(</span><span class="nam">cdn_domain_name</span><span class="op">)</span> <span class="op">+</span> <span class="str">')$'</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="pln">                        <span class="nam">old_operator_url</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="pln">                    <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm run hide_run">                    <span class="nam">my_sub_domain_name</span> <span class="op">=</span> <span class="nam">regex_match</span><span class="op">.</span><span class="nam">groups</span><span class="op">(</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="stm par run hide_run"><span class="annotate short">95&#x202F;&#x219B;&#x202F;96</span><span class="annotate long">line 95 didn't jump to line 96, because the condition on line 95 was never true</span>                    <span class="key">if</span> <span class="nam">my_sub_domain_name</span> <span class="key">is</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm mis">                        <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span><span class="str">'Unable to parse old provider url'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln">                    <span class="com"># add to cname record</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="stm run hide_run">                    <span class="nam">my_sub_domain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_subdomain</span><span class="op">(</span><span class="nam">my_sub_domain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="stm run hide_run">                    <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="pln">                        <span class="str">"Updating DNS Record for HTTPS upgrade "</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln">                        <span class="str">"domain {0}. CNAME update from {1} to {2}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="pln">                            <span class="nam">my_sub_domain_name</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln">                            <span class="nam">old_operator_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln">                            <span class="nam">links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="pln">                        <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln">                    <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t109" class="stm run hide_run">                    <span class="nam">old_dns_record</span> <span class="op">=</span> <span class="nam">my_sub_domain</span><span class="op">.</span><span class="nam">find_record</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="pln">                        <span class="str">'CNAME'</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln">                        <span class="nam">old_operator_url</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="pln">                    <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="stm run hide_run">                    <span class="nam">my_sub_domain</span><span class="op">.</span><span class="nam">update_record</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="pln">                        <span class="nam">old_dns_record</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln">                        <span class="nam">data</span><span class="op">=</span><span class="nam">links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="pln">                    <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t118" class="stm run hide_run">                    <span class="nam">dns_links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="pln">                        <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln">                        <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">old_operator_url</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln">                    <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm run hide_run">                    <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="pln">                <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm run hide_run">                    <span class="nam">name</span> <span class="op">=</span> <span class="str">'{0}.{1}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">domain_name</span><span class="op">,</span> <span class="nam">subdomain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t126" class="stm run hide_run">            <span class="nam">cname_record</span> <span class="op">=</span> <span class="op">{</span><span class="str">'type'</span><span class="op">:</span> <span class="str">'CNAME'</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln">                            <span class="str">'name'</span><span class="op">:</span> <span class="nam">name</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln">                            <span class="str">'data'</span><span class="op">:</span> <span class="nam">links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="pln">                            <span class="str">'ttl'</span><span class="op">:</span> <span class="num">300</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm run hide_run">            <span class="nam">dns_links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="pln">                <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">links</span><span class="op">[</span><span class="nam">link</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t132" class="pln">                <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">name</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t135" class="stm run hide_run">            <span class="key">if</span> <span class="nam">certificate</span> <span class="op">==</span> <span class="str">"shared"</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="stm run hide_run">                <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Creating Shared SSL DNS Record - {0}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">name</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="stm run hide_run">                <span class="nam">shared_ssl_subdomain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_subdomain</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="pln">                    <span class="nam">shared_ssl_subdomain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="stm run hide_run">                <span class="nam">shared_ssl_subdomain</span><span class="op">.</span><span class="nam">add_records</span><span class="op">(</span><span class="op">[</span><span class="nam">cname_record</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="pln">            <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm run hide_run">                <span class="nam">cname_records</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">cname_record</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="pln">        <span class="com"># add the cname records</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="stm run hide_run">        <span class="key">if</span> <span class="nam">cname_records</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Creating DNS Record - {0}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">cname_records</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm run hide_run">            <span class="nam">subdomain</span><span class="op">.</span><span class="nam">add_records</span><span class="op">(</span><span class="nam">cname_records</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm run hide_run">        <span class="key">return</span> <span class="nam">dns_links</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_search_cname_record</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">access_url</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="pln">        <span class="str">"""Search a CNAME record</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t151" class="pln"><span class="str">        :param access_url: DNS Access URL</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="pln"><span class="str">        :param shared_ssl_flag: flag indicating if this is a shared ssl domain</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln"><span class="str">        :return records: returns records, if any</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln">        <span class="com"># extract shard name</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm par run hide_run"><span class="annotate short">157&#x202F;&#x219B;&#x202F;158</span><span class="annotate long">line 157 didn't jump to line 158, because the condition on line 157 was never true</span>        <span class="key">if</span> <span class="nam">shared_ssl_flag</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm mis">            <span class="nam">suffix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shared_ssl_domain_suffix</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm run hide_run">            <span class="nam">suffix</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">url</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="pln">        <span class="com"># Note: use rindex to find last occurence of the suffix</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm run hide_run">        <span class="nam">shard_name</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="op">:</span><span class="nam">access_url</span><span class="op">.</span><span class="nam">rindex</span><span class="op">(</span><span class="nam">suffix</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">'.'</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm run hide_run">        <span class="nam">subdomain_name</span> <span class="op">=</span> <span class="str">'.'</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="op">[</span><span class="nam">shard_name</span><span class="op">,</span> <span class="nam">suffix</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t165" class="pln">        <span class="com"># for sharding is disabled, the suffix is the subdomain_name</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm par run hide_run"><span class="annotate short">166&#x202F;&#x219B;&#x202F;168</span><span class="annotate long">line 166 didn't jump to line 168, because the condition on line 166 was never true</span>        <span class="key">if</span> <span class="nam">shared_ssl_flag</span> <span class="key">and</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="pln">                <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shared_ssl_num_shards</span> <span class="op">==</span> <span class="num">0</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm mis">            <span class="nam">subdomain_name</span> <span class="op">=</span> <span class="nam">suffix</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="pln">        <span class="com"># get subdomain</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm run hide_run">        <span class="nam">subdomain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="nam">subdomain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="pln">        <span class="com"># search and find the CNAME record</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm run hide_run">        <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">'Searching DNS records for : {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">subdomain</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm run hide_run">        <span class="nam">name</span> <span class="op">=</span> <span class="nam">access_url</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="stm run hide_run">        <span class="nam">record_type</span> <span class="op">=</span> <span class="str">'CNAME'</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm run hide_run">        <span class="nam">records</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">search_records</span><span class="op">(</span><span class="nam">subdomain</span><span class="op">,</span> <span class="nam">record_type</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm run hide_run">        <span class="key">return</span> <span class="nam">records</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_delete_cname_record</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">access_url</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="pln">        <span class="str">"""Delete a CNAME record</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t183" class="pln"><span class="str">        :param access_url: DNS Access URL</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="pln"><span class="str">        :param shared_ssl_flag: flag indicating if this is a shared ssl domain</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="pln"><span class="str">        :return error_msg: returns error message, if any</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm run hide_run">        <span class="nam">records</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_search_cname_record</span><span class="op">(</span><span class="nam">access_url</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln">        <span class="com"># delete the record</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln">        <span class="com"># we should get one record,</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="pln">        <span class="com"># or none if it has been deleted already</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="stm run hide_run">        <span class="key">if</span> <span class="key">not</span> <span class="nam">records</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t193" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'DNS record already deleted: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="stm run hide_run">        <span class="key">elif</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="stm run hide_run">            <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">'Multiple DNS records found: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="nam">error_msg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm run hide_run">            <span class="key">return</span> <span class="nam">error_msg</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm par run hide_run"><span class="annotate short">198&#x202F;&#x219B;&#x202F;201</span><span class="annotate long">line 198 didn't jump to line 201, because the condition on line 198 was never false</span>        <span class="key">elif</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">'Deleting DNS records for : {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm run hide_run">            <span class="nam">records</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">delete</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="stm run hide_run">        <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t202" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t203" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_change_cname_record</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">access_url</span><span class="op">,</span> <span class="nam">target_url</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t204" class="pln">        <span class="str">"""Change a CNAME record</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t206" class="pln"><span class="str">        :param access_url: DNS Access URL</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="pln"><span class="str">        :param target_url: Operator Access URL</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="pln"><span class="str">        :param shared_ssl_flag: flag indicating if this is a shared ssl domain</span><span class="strut">&nbsp;</span></p>
<p id="t209" class="pln"><span class="str">        :return error_msg: returns error message, if any</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t211" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm run hide_run">        <span class="nam">records</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_search_cname_record</span><span class="op">(</span><span class="nam">access_url</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="pln">        <span class="com"># we should get one record, or none if it has been deleted already</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="stm par run hide_run"><span class="annotate short">214&#x202F;&#x219B;&#x202F;215</span><span class="annotate long">line 214 didn't jump to line 215, because the condition on line 214 was never true</span>        <span class="key">if</span> <span class="key">not</span> <span class="nam">records</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="stm mis">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'DNS record not found for: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="stm par run hide_run"><span class="annotate short">216&#x202F;&#x219B;&#x202F;217,&nbsp;&nbsp; 216&#x202F;&#x219B;&#x202F;218</span><span class="annotate long">2 missed branches: 1) line 216 didn't jump to line 217, because the condition on line 216 was never true, 2) line 216 didn't jump to line 218, because the condition on line 216 was never false</span>        <span class="key">elif</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span> <span class="op">></span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t217" class="stm mis">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'Multiple DNS records found: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="stm mis">        <span class="key">elif</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="stm mis">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">'Updating DNS record for : {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="stm mis">            <span class="nam">records</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">data</span><span class="op">=</span><span class="nam">target_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm mis">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">'Updated DNS record for : {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm mis">        <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_generate_sharded_domain_name</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">shard_prefix</span><span class="op">,</span> <span class="nam">num_shards</span><span class="op">,</span> <span class="nam">suffix</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="pln">        <span class="str">"""Generate a sharded domain name based on the scheme:</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t228" class="pln"><span class="str">        '{shard_prefix}{a random shard_id}.{suffix}'</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t230" class="pln"><span class="str">        :return A string of sharded domain name</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm mis">        <span class="key">if</span> <span class="nam">num_shards</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="pln">            <span class="com"># shard disabled, just use the suffix</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="stm mis">            <span class="key">yield</span> <span class="nam">suffix</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="pln">            <span class="com"># shard enabled, iterate through shards after</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="pln">            <span class="com">#  randomly shuffling them</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="stm mis">            <span class="nam">shard_ids</span> <span class="op">=</span> <span class="op">[</span><span class="nam">i</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">1</span><span class="op">,</span> <span class="nam">num_shards</span> <span class="op">+</span> <span class="num">1</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t239" class="stm mis">            <span class="nam">random</span><span class="op">.</span><span class="nam">shuffle</span><span class="op">(</span><span class="nam">shard_ids</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="stm mis">            <span class="key">for</span> <span class="nam">shard_id</span> <span class="key">in</span> <span class="nam">shard_ids</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="stm mis">                <span class="key">yield</span> <span class="str">'{0}{1}.{2}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">shard_prefix</span><span class="op">,</span> <span class="nam">shard_id</span><span class="op">,</span> <span class="nam">suffix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t243" class="stm run hide_run">    <span class="key">def</span> <span class="nam">generate_shared_ssl_domain_suffix</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="pln">        <span class="str">"""Rackspace DNS scheme to generate a shared ssl domain suffix,</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t246" class="pln"><span class="str">        to be used with manager for shared ssl feature</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t248" class="pln"><span class="str">        :return A string of shared ssl domain name</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t250" class="stm mis">        <span class="nam">shared_ssl_domain_name</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_generate_sharded_domain_name</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="pln">            <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shared_ssl_shard_prefix</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t252" class="pln">            <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shared_ssl_num_shards</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t253" class="pln">            <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">shared_ssl_domain_suffix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t255" class="stm mis">        <span class="key">return</span> <span class="nam">shared_ssl_domain_name</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t257" class="stm run hide_run">    <span class="key">def</span> <span class="nam">create</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">responders</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t258" class="pln">        <span class="str">"""Create CNAME record for a service.</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t260" class="pln"><span class="str">        :param responders: responders from providers</span><span class="strut">&nbsp;</span></p>
<p id="t261" class="pln"><span class="str">        :return dns_links: Map from provider urls to DNS urls</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t264" class="stm run hide_run">        <span class="nam">providers</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t267" class="stm run hide_run">                <span class="nam">providers</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">provider</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t269" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t270" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="stm run hide_run">                <span class="key">if</span> <span class="str">'error'</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t272" class="stm run hide_run">                    <span class="nam">error_msg</span> <span class="op">=</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'error_detail'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t273" class="stm run hide_run">                    <span class="nam">error_dict</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="pln">                        <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="pln">                    <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t276" class="stm run hide_run">                    <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t278" class="pln">        <span class="com"># gather the provider urls and cname them</span><span class="strut">&nbsp;</span></p>
<p id="t279" class="stm run hide_run">        <span class="nam">links</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="stm run hide_run">                    <span class="key">if</span> <span class="nam">link</span><span class="op">[</span><span class="str">'rel'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'access_url'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="pln">                        <span class="com"># We need to distinguish shared ssl domains in</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="pln">                        <span class="com"># which case the we will use different shard prefix and</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="pln">                        <span class="com"># and shard number</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="stm run hide_run">                        <span class="nam">links</span><span class="op">[</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t288" class="pln">                            <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="pln">                            <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="pln">                            <span class="nam">None</span>  <span class="com"># new link no pref operator url</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="pln">                        <span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="nam">link</span><span class="op">[</span><span class="str">'href'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t293" class="pln">        <span class="com"># create CNAME records</span><span class="strut">&nbsp;</span></p>
<p id="t294" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t295" class="stm run hide_run">            <span class="nam">dns_links</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_create_cname_records</span><span class="op">(</span><span class="nam">links</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t296" class="stm run hide_run">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t297" class="stm run hide_run">            <span class="nam">msg</span> <span class="op">=</span> <span class="str">'Rackspace DNS Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t298" class="stm run hide_run">            <span class="nam">error</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t301" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t303" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t304" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t305" class="pln">        <span class="com"># gather the CNAMED links</span><span class="strut">&nbsp;</span></p>
<p id="t306" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t307" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t308" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t309" class="stm run hide_run">                <span class="nam">access_urls</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t311" class="stm run hide_run">                    <span class="key">if</span> <span class="nam">link</span><span class="op">[</span><span class="str">'rel'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'access_url'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t312" class="stm run hide_run">                        <span class="nam">access_url</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t313" class="pln">                            <span class="str">'domain'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t314" class="pln">                            <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">dns_links</span><span class="op">[</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="pln">                                <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t316" class="pln">                                <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t317" class="pln">                                <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="pln">                            <span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="str">'provider_url'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t319" class="pln">                            <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">dns_links</span><span class="op">[</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t320" class="pln">                                <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="pln">                                <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t322" class="pln">                                <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="pln">                            <span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t324" class="pln">                        <span class="com"># Need to indicate if this access_url is a shared ssl</span><span class="strut">&nbsp;</span></p>
<p id="t325" class="pln">                        <span class="com"># access url, since its has different shard_prefix and</span><span class="strut">&nbsp;</span></p>
<p id="t326" class="pln">                        <span class="com"># num_shard</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="stm run hide_run">                        <span class="key">if</span> <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span> <span class="op">==</span> <span class="str">'shared'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t328" class="stm run hide_run">                            <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t329" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t330" class="stm run hide_run">                        <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t331" class="stm run hide_run">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="nam">access_urls</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="stm run hide_run">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">created</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t333" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t334" class="stm run hide_run">    <span class="key">def</span> <span class="nam">delete</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">provider_details</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t335" class="pln">        <span class="str">"""Delete CNAME records for a service.</span><span class="strut">&nbsp;</span></p>
<p id="t336" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t337" class="pln"><span class="str">        :param provider_details</span><span class="strut">&nbsp;</span></p>
<p id="t338" class="pln"><span class="str">        :return dns_details: Map from provider_name to delete errors</span><span class="strut">&nbsp;</span></p>
<p id="t339" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t340" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t341" class="stm run hide_run">        <span class="nam">providers</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="stm run hide_run">            <span class="nam">providers</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">provider</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t344" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t345" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t346" class="stm run hide_run">        <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">''</span><span class="strut">&nbsp;</span></p>
<p id="t347" class="stm run hide_run">        <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t348" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t349" class="stm run hide_run">            <span class="nam">access_urls</span> <span class="op">=</span> <span class="nam">provider_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">.</span><span class="nam">access_urls</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="stm run hide_run">            <span class="key">for</span> <span class="nam">access_url</span> <span class="key">in</span> <span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t351" class="stm run hide_run">                <span class="key">if</span> <span class="str">'operator_url'</span> <span class="key">in</span> <span class="nam">access_url</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t352" class="stm run hide_run">                    <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t353" class="stm run hide_run">                        <span class="nam">msg</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_delete_cname_record</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t354" class="pln">                            <span class="nam">access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="pln">                            <span class="nam">access_url</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'shared_ssl_flag'</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t356" class="stm run hide_run">                        <span class="key">if</span> <span class="nam">msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t357" class="stm run hide_run">                            <span class="nam">error_msg</span> <span class="op">+=</span> <span class="nam">msg</span><span class="strut">&nbsp;</span></p>
<p id="t358" class="stm run hide_run">                    <span class="key">except</span> <span class="nam">exc</span><span class="op">.</span><span class="nam">NotFound</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t359" class="stm run hide_run">                        <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'Can not access the subdomain. Please make '</span><span class="strut">&nbsp;</span></p>
<p id="t360" class="pln">                                  <span class="str">'sure it exists and you have permissions '</span><span class="strut">&nbsp;</span></p>
<p id="t361" class="pln">                                  <span class="str">'to CDN subdomain {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t362" class="stm run hide_run">                        <span class="nam">error_msg</span> <span class="op">=</span> <span class="op">(</span><span class="nam">error_msg</span> <span class="op">+</span> <span class="str">'Can not access subdomain . '</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="pln">                                     <span class="str">'Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t364" class="stm run hide_run">                        <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="stm run hide_run">                    <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t366" class="stm run hide_run">                        <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'Rackspace DNS Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="stm run hide_run">                        <span class="nam">error_msg</span> <span class="op">+=</span> <span class="str">'Rackspace DNS '</span> <span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="pln">                                     <span class="str">'Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t369" class="stm run hide_run">                        <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t370" class="pln">                <span class="com"># format the error message for this provider</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="stm run hide_run">            <span class="key">if</span> <span class="key">not</span> <span class="nam">error_msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="stm run hide_run">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">deleted</span><span class="op">(</span><span class="op">{</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t373" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t374" class="pln">        <span class="com"># format the error message</span><span class="strut">&nbsp;</span></p>
<p id="t375" class="stm run hide_run">        <span class="key">if</span> <span class="nam">error_msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t376" class="stm run hide_run">            <span class="nam">error</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t377" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t378" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">error_class</span><span class="strut">&nbsp;</span></p>
<p id="t379" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t380" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t382" class="stm run hide_run">        <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t383" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t384" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_update_added_domains</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">responders</span><span class="op">,</span> <span class="nam">added_domains</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t385" class="pln">        <span class="str">"""Update added domains."""</span><span class="strut">&nbsp;</span></p>
<p id="t386" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t387" class="pln">        <span class="com"># if no domains are added, return</span><span class="strut">&nbsp;</span></p>
<p id="t388" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t389" class="stm run hide_run">        <span class="key">if</span> <span class="key">not</span> <span class="nam">added_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t390" class="stm run hide_run">            <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="stm run hide_run">                <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="stm run hide_run">                    <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t393" class="stm run hide_run">            <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t394" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t395" class="stm run hide_run">        <span class="nam">providers</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t396" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t397" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t398" class="stm run hide_run">                <span class="nam">providers</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">provider</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t400" class="pln">        <span class="com"># gather the provider links for the added domains</span><span class="strut">&nbsp;</span></p>
<p id="t401" class="stm run hide_run">        <span class="nam">links</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t404" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t405" class="stm run hide_run">                    <span class="nam">domain_added</span> <span class="op">=</span> <span class="op">(</span><span class="nam">link</span><span class="op">[</span><span class="str">'rel'</span><span class="op">]</span> <span class="op">==</span> <span class="str">'access_url'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t406" class="pln">                                    <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">in</span> <span class="nam">added_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="stm run hide_run">                    <span class="key">if</span> <span class="nam">domain_added</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t408" class="stm run hide_run">                        <span class="nam">links</span><span class="op">[</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t409" class="pln">                            <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t410" class="pln">                            <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t411" class="pln">                            <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'old_operator_url'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t412" class="pln">                        <span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="nam">link</span><span class="op">[</span><span class="str">'href'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t414" class="pln">        <span class="com"># create CNAME records for added domains</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="stm run hide_run">            <span class="nam">dns_links</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_create_cname_records</span><span class="op">(</span><span class="nam">links</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="stm run hide_run">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm run hide_run">            <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">'Rackspace DNS Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm run hide_run">            <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="stm run hide_run">            <span class="nam">error</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t422" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">error_class</span><span class="strut">&nbsp;</span></p>
<p id="t423" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="nam">error_msg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t425" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t426" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t427" class="pln">        <span class="com"># gather the CNAMED links for added domains</span><span class="strut">&nbsp;</span></p>
<p id="t428" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t429" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="stm run hide_run">                <span class="nam">access_urls</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t432" class="stm run hide_run">                    <span class="key">if</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">in</span> <span class="nam">added_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t433" class="stm run hide_run">                        <span class="nam">access_url</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="pln">                            <span class="str">'domain'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln">                            <span class="str">'provider_url'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t436" class="pln">                                <span class="nam">dns_links</span><span class="op">[</span><span class="op">(</span><span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="pln">                                           <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="pln">                                           <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'old_operator_url'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t439" class="pln">                                           <span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="str">'provider_url'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t440" class="pln">                            <span class="str">'operator_url'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t441" class="pln">                                <span class="nam">dns_links</span><span class="op">[</span><span class="op">(</span><span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t442" class="pln">                                           <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t443" class="pln">                                           <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'old_operator_url'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t444" class="pln">                                           <span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t445" class="pln">                        <span class="com"># Need to indicate if this access_url is a shared ssl</span><span class="strut">&nbsp;</span></p>
<p id="t446" class="pln">                        <span class="com"># access url, since its has different shard_prefix and</span><span class="strut">&nbsp;</span></p>
<p id="t447" class="pln">                        <span class="com"># num_shard</span><span class="strut">&nbsp;</span></p>
<p id="t448" class="stm par run hide_run"><span class="annotate short">448&#x202F;&#x219B;&#x202F;449</span><span class="annotate long">line 448 didn't jump to line 449, because the condition on line 448 was never true</span>                        <span class="key">if</span> <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span> <span class="op">==</span> <span class="str">'shared'</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t449" class="stm mis">                            <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t450" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t451" class="stm run hide_run">                        <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t452" class="stm run hide_run">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="nam">access_urls</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t453" class="stm run hide_run">        <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t454" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t455" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_update_removed_domains</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">provider_details</span><span class="op">,</span> <span class="nam">removed_domains</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t456" class="pln">        <span class="str">"""Update removed domains."""</span><span class="strut">&nbsp;</span></p>
<p id="t457" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t458" class="pln">        <span class="com"># if no domains are removed, return</span><span class="strut">&nbsp;</span></p>
<p id="t459" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t460" class="stm run hide_run">        <span class="key">if</span> <span class="key">not</span> <span class="nam">removed_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t461" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t462" class="stm run hide_run">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t463" class="stm run hide_run">            <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t464" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t465" class="stm run hide_run">        <span class="nam">providers</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t466" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t467" class="stm run hide_run">            <span class="nam">providers</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">provider</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t468" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t469" class="pln">        <span class="com"># delete the records for deleted domains</span><span class="strut">&nbsp;</span></p>
<p id="t470" class="stm run hide_run">        <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">''</span><span class="strut">&nbsp;</span></p>
<p id="t471" class="stm run hide_run">        <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t472" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t473" class="stm run hide_run">            <span class="nam">provider_detail</span> <span class="op">=</span> <span class="nam">provider_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t474" class="stm run hide_run">            <span class="key">for</span> <span class="nam">access_url</span> <span class="key">in</span> <span class="nam">provider_detail</span><span class="op">.</span><span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t475" class="pln">                <span class="com"># log delivery access url does not have domain field</span><span class="strut">&nbsp;</span></p>
<p id="t476" class="stm run hide_run">                <span class="key">if</span> <span class="str">'domain'</span> <span class="key">in</span> <span class="nam">access_url</span> <span class="key">and</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t477" class="pln">                        <span class="nam">access_url</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">removed_domains</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t478" class="stm run hide_run">                    <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t479" class="stm run hide_run">                <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t480" class="stm run hide_run">                    <span class="nam">msg</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_delete_cname_record</span><span class="op">(</span><span class="nam">access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t481" class="pln">                                                    <span class="nam">access_url</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t482" class="pln">                                                        <span class="str">'shared_ssl_flag'</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t483" class="pln">                                                        <span class="nam">False</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t484" class="stm mis">                    <span class="key">if</span> <span class="nam">msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t485" class="stm mis">                        <span class="nam">error_msg</span> <span class="op">=</span> <span class="nam">error_msg</span> <span class="op">+</span> <span class="nam">msg</span><span class="strut">&nbsp;</span></p>
<p id="t486" class="stm par run hide_run"><span class="annotate short">486&#x202F;&#x219B;&#x202F;487</span><span class="annotate long">line 486 didn't jump to line 487, because the exception caught by line 486 didn't happen</span>                <span class="key">except</span> <span class="nam">exc</span><span class="op">.</span><span class="nam">NotFound</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t487" class="stm mis">                    <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'Can not access the subdomain. Please make sure'</span><span class="strut">&nbsp;</span></p>
<p id="t488" class="pln">                              <span class="str">' it exists and you have permissions to CDN '</span><span class="strut">&nbsp;</span></p>
<p id="t489" class="pln">                              <span class="str">'subdomain {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t490" class="stm mis">                    <span class="nam">error_msg</span> <span class="op">=</span> <span class="op">(</span><span class="nam">error_msg</span> <span class="op">+</span> <span class="str">'Can not access subdomain. '</span><span class="strut">&nbsp;</span></p>
<p id="t491" class="pln">                                 <span class="str">'Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t492" class="stm mis">                    <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t493" class="stm run hide_run">                <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t494" class="stm run hide_run">                    <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">'Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t495" class="stm run hide_run">                    <span class="nam">error_msg</span> <span class="op">=</span> <span class="nam">error_msg</span> <span class="op">+</span> <span class="str">'Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t496" class="stm run hide_run">                    <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t497" class="pln">            <span class="com"># format the success message for this provider</span><span class="strut">&nbsp;</span></p>
<p id="t498" class="stm par run hide_run"><span class="annotate short">498&#x202F;&#x219B;&#x202F;499</span><span class="annotate long">line 498 didn't jump to line 499, because the condition on line 498 was never true</span>            <span class="key">if</span> <span class="key">not</span> <span class="nam">error_msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t499" class="stm mis">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">deleted</span><span class="op">(</span><span class="op">{</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t500" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t501" class="pln">        <span class="com"># format the error message</span><span class="strut">&nbsp;</span></p>
<p id="t502" class="stm par run hide_run"><span class="annotate short">502&#x202F;&#x219B;&#x202F;509</span><span class="annotate long">line 502 didn't jump to line 509, because the condition on line 502 was never false</span>        <span class="key">if</span> <span class="nam">error_msg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t503" class="stm run hide_run">            <span class="nam">error_dict</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t504" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t505" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">error_class</span><span class="strut">&nbsp;</span></p>
<p id="t506" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t507" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t508" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t509" class="stm mis">        <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t510" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t511" class="stm run hide_run">    <span class="key">def</span> <span class="nam">update</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">service_old</span><span class="op">,</span> <span class="nam">service_updates</span><span class="op">,</span> <span class="nam">responders</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t512" class="pln">        <span class="str">"""Update CNAME records for a service.</span><span class="strut">&nbsp;</span></p>
<p id="t513" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t514" class="pln"><span class="str">        :param service_old: previous service state</span><span class="strut">&nbsp;</span></p>
<p id="t515" class="pln"><span class="str">        :param service_updates: updates to service state</span><span class="strut">&nbsp;</span></p>
<p id="t516" class="pln"><span class="str">        :param responders: responders from providers</span><span class="strut">&nbsp;</span></p>
<p id="t517" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t518" class="pln"><span class="str">        :return dns_details: Map from provider_name to update errors</span><span class="strut">&nbsp;</span></p>
<p id="t519" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t520" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t521" class="pln">        <span class="com"># get old domains</span><span class="strut">&nbsp;</span></p>
<p id="t522" class="stm run hide_run">        <span class="nam">old_domains</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t523" class="stm run hide_run">        <span class="nam">old_access_urls_map</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t524" class="stm run hide_run">        <span class="nam">project_id</span> <span class="op">=</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">project_id</span><span class="strut">&nbsp;</span></p>
<p id="t525" class="stm run hide_run">        <span class="nam">service_id</span> <span class="op">=</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">service_id</span><span class="strut">&nbsp;</span></p>
<p id="t526" class="stm run hide_run">        <span class="nam">provider_details</span> <span class="op">=</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">provider_details</span><span class="strut">&nbsp;</span></p>
<p id="t527" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t528" class="stm run hide_run">            <span class="nam">provider_detail</span> <span class="op">=</span> <span class="nam">provider_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t529" class="stm run hide_run">            <span class="nam">access_urls</span> <span class="op">=</span> <span class="nam">provider_detail</span><span class="op">.</span><span class="nam">access_urls</span><span class="strut">&nbsp;</span></p>
<p id="t530" class="stm run hide_run">            <span class="nam">old_access_urls_map</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="nam">access_urls</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t531" class="stm run hide_run">            <span class="key">for</span> <span class="nam">access_url</span> <span class="key">in</span> <span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t532" class="stm run hide_run">                <span class="key">if</span> <span class="str">'domain'</span> <span class="key">in</span> <span class="nam">access_url</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t533" class="stm run hide_run">                    <span class="nam">old_domains</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">access_url</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t534" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t535" class="pln">        <span class="com"># if there is a provider error, don't try dns update</span><span class="strut">&nbsp;</span></p>
<p id="t536" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t537" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t538" class="stm run hide_run">                <span class="key">if</span> <span class="str">'error'</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t539" class="stm run hide_run">                    <span class="key">return</span> <span class="nam">old_access_urls_map</span><span class="strut">&nbsp;</span></p>
<p id="t540" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t541" class="pln">        <span class="com"># get new_domains</span><span class="strut">&nbsp;</span></p>
<p id="t542" class="stm run hide_run">        <span class="nam">new_domains</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t543" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t544" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t545" class="stm run hide_run">                <span class="nam">links</span> <span class="op">=</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t546" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">links</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t547" class="stm run hide_run">                    <span class="nam">new_domains</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t548" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t549" class="pln">        <span class="com"># find http -> https+san upgrade domains</span><span class="strut">&nbsp;</span></p>
<p id="t550" class="stm run hide_run">        <span class="nam">upgraded_domains</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t551" class="stm run hide_run">        <span class="key">for</span> <span class="nam">domain</span> <span class="key">in</span> <span class="nam">service_updates</span><span class="op">.</span><span class="nam">domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t552" class="stm run hide_run">            <span class="key">for</span> <span class="nam">old_domain</span> <span class="key">in</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t553" class="stm run hide_run">                <span class="key">if</span> <span class="nam">old_domain</span><span class="op">.</span><span class="nam">domain</span> <span class="op">==</span> <span class="nam">domain</span><span class="op">.</span><span class="nam">domain</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t554" class="stm par run hide_run"><span class="annotate short">554&#x202F;&#x219B;&#x202F;559</span><span class="annotate long">line 554 didn't jump to line 559</span>                    <span class="key">if</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t555" class="pln">                        <span class="nam">old_domain</span><span class="op">.</span><span class="nam">protocol</span> <span class="op">==</span> <span class="str">'http'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t556" class="pln">                        <span class="nam">domain</span><span class="op">.</span><span class="nam">protocol</span> <span class="op">==</span> <span class="str">'https'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t557" class="pln">                        <span class="nam">domain</span><span class="op">.</span><span class="nam">certificate</span> <span class="op">==</span> <span class="str">'san'</span><span class="strut">&nbsp;</span></p>
<p id="t558" class="pln">                    <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t559" class="stm mis">                        <span class="nam">upgraded_domains</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">domain</span><span class="op">.</span><span class="nam">domain</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t560" class="stm mis">                        <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t561" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t562" class="pln">        <span class="com"># if domains have not been updated, return</span><span class="strut">&nbsp;</span></p>
<p id="t563" class="stm run hide_run">        <span class="key">if</span> <span class="key">not</span> <span class="nam">service_updates</span><span class="op">.</span><span class="nam">domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t564" class="stm run hide_run">            <span class="key">return</span> <span class="nam">old_access_urls_map</span><span class="strut">&nbsp;</span></p>
<p id="t565" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t566" class="pln">        <span class="com"># force dns update when we encounter an upgraded domain</span><span class="strut">&nbsp;</span></p>
<p id="t567" class="stm run hide_run">        <span class="nam">common_domains</span> <span class="op">=</span> <span class="nam">new_domains</span><span class="op">.</span><span class="nam">intersection</span><span class="op">(</span><span class="nam">old_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t568" class="stm run hide_run">        <span class="key">for</span> <span class="nam">domain_name</span> <span class="key">in</span> <span class="nam">common_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t569" class="stm run hide_run">            <span class="nam">upgrade</span> <span class="op">=</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t570" class="stm run hide_run">            <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t571" class="stm run hide_run">                <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t572" class="stm run hide_run">                    <span class="nam">links</span> <span class="op">=</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t573" class="stm run hide_run">                    <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">links</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t574" class="stm run hide_run">                        <span class="key">if</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t575" class="pln">                            <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="op">==</span> <span class="nam">domain_name</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t576" class="pln">                            <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'certificate'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span> <span class="op">==</span> <span class="str">'san'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t577" class="pln">                            <span class="nam">link</span><span class="op">[</span><span class="str">'href'</span><span class="op">]</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t578" class="pln">                            <span class="nam">link</span><span class="op">[</span><span class="str">'old_operator_url'</span><span class="op">]</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t579" class="pln">                        <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t580" class="stm run hide_run">                            <span class="nam">upgrade</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t581" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t582" class="stm run hide_run">            <span class="key">if</span> <span class="nam">upgrade</span> <span class="key">is</span> <span class="nam">True</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t583" class="stm run hide_run">                <span class="nam">old_domains</span><span class="op">.</span><span class="nam">remove</span><span class="op">(</span><span class="nam">domain_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t584" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t585" class="pln">        <span class="com"># if the old set of domains is the same as new set of domains return</span><span class="strut">&nbsp;</span></p>
<p id="t586" class="stm run hide_run">        <span class="key">if</span> <span class="nam">old_domains</span> <span class="op">==</span> <span class="nam">new_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t587" class="stm run hide_run">            <span class="key">return</span> <span class="nam">old_access_urls_map</span><span class="strut">&nbsp;</span></p>
<p id="t588" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t589" class="pln">        <span class="com"># get the list of added, removed and common domains</span><span class="strut">&nbsp;</span></p>
<p id="t590" class="stm run hide_run">        <span class="nam">added_domains</span> <span class="op">=</span> <span class="nam">new_domains</span><span class="op">.</span><span class="nam">difference</span><span class="op">(</span><span class="nam">old_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t591" class="stm run hide_run">        <span class="nam">removed_domains</span> <span class="op">=</span> <span class="nam">old_domains</span><span class="op">.</span><span class="nam">difference</span><span class="op">(</span><span class="nam">new_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t592" class="stm run hide_run">        <span class="nam">common_domains</span> <span class="op">=</span> <span class="nam">new_domains</span><span class="op">.</span><span class="nam">intersection</span><span class="op">(</span><span class="nam">old_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t593" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t594" class="pln">        <span class="com"># prevent dns records for upgrade domains from being deleted</span><span class="strut">&nbsp;</span></p>
<p id="t595" class="stm run hide_run">        <span class="nam">retain_domains</span> <span class="op">=</span> <span class="nam">removed_domains</span><span class="op">.</span><span class="nam">intersection</span><span class="op">(</span><span class="nam">upgraded_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t596" class="stm run hide_run">        <span class="nam">removed_domains</span> <span class="op">=</span> <span class="nam">removed_domains</span><span class="op">.</span><span class="nam">difference</span><span class="op">(</span><span class="nam">retain_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t597" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t598" class="stm run hide_run">        <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Added Domains : {0} on service_id : {1} "</span><span class="strut">&nbsp;</span></p>
<p id="t599" class="pln">                 <span class="str">"for project_id: {2}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">added_domains</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t600" class="pln">                                              <span class="nam">service_id</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t601" class="pln">                                              <span class="nam">project_id</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t602" class="stm run hide_run">        <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Removed Domains : {0} on service_id : {1} "</span><span class="strut">&nbsp;</span></p>
<p id="t603" class="pln">                 <span class="str">"for project_id: {2}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">removed_domains</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t604" class="pln">                                              <span class="nam">service_id</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t605" class="pln">                                              <span class="nam">project_id</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t606" class="stm run hide_run">        <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="str">"Common Domains : {0} on service_id : {1} "</span><span class="strut">&nbsp;</span></p>
<p id="t607" class="pln">                 <span class="str">"for project_id: {2}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">common_domains</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t608" class="pln">                                              <span class="nam">service_id</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t609" class="pln">                                              <span class="nam">project_id</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t610" class="pln">        <span class="com"># add new domains</span><span class="strut">&nbsp;</span></p>
<p id="t611" class="stm run hide_run">        <span class="nam">dns_links</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_update_added_domains</span><span class="op">(</span><span class="nam">responders</span><span class="op">,</span> <span class="nam">added_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t612" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t613" class="pln">        <span class="com"># remove CNAME records for deleted domains</span><span class="strut">&nbsp;</span></p>
<p id="t614" class="stm run hide_run">        <span class="nam">provider_details</span> <span class="op">=</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">provider_details</span><span class="strut">&nbsp;</span></p>
<p id="t615" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_update_removed_domains</span><span class="op">(</span><span class="nam">provider_details</span><span class="op">,</span> <span class="nam">removed_domains</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t616" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t617" class="stm run hide_run">        <span class="nam">providers</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t618" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t619" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t620" class="stm run hide_run">                <span class="nam">providers</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">provider</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t621" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t622" class="pln">        <span class="com"># in case of DNS error, return</span><span class="strut">&nbsp;</span></p>
<p id="t623" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">dns_links</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t624" class="stm run hide_run">            <span class="key">if</span> <span class="str">'error'</span> <span class="key">in</span> <span class="nam">dns_links</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t625" class="stm run hide_run">                <span class="nam">error_msg</span> <span class="op">=</span> <span class="nam">dns_links</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'error_detail'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t626" class="stm run hide_run">                <span class="nam">error_dict</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t627" class="pln">                    <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="strut">&nbsp;</span></p>
<p id="t628" class="pln">                <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t629" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t630" class="stm par run hide_run"><span class="annotate short">630&#x202F;&#x219B;&#x202F;634</span><span class="annotate long">line 630 didn't jump to line 634, because the condition on line 630 was never false</span>                <span class="key">if</span> <span class="str">'error_class'</span> <span class="key">in</span> <span class="nam">dns_links</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t631" class="stm run hide_run">                    <span class="nam">error_dict</span><span class="op">[</span><span class="str">'error_class'</span><span class="op">]</span> <span class="op">=</span> <span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t632" class="pln">                        <span class="nam">dns_links</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'error_class'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t633" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t634" class="stm run hide_run">                <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">providers</span><span class="op">,</span> <span class="nam">error_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t635" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t636" class="pln">        <span class="com"># gather the CNAMED links and remove stale links</span><span class="strut">&nbsp;</span></p>
<p id="t637" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t638" class="stm run hide_run">        <span class="key">for</span> <span class="nam">responder</span> <span class="key">in</span> <span class="nam">responders</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t639" class="stm run hide_run">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t640" class="stm run hide_run">                <span class="nam">provider_detail</span> <span class="op">=</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">provider_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t641" class="stm run hide_run">                <span class="nam">old_access_urls</span> <span class="op">=</span> <span class="nam">provider_detail</span><span class="op">.</span><span class="nam">access_urls</span><span class="strut">&nbsp;</span></p>
<p id="t642" class="stm run hide_run">                <span class="nam">new_access_urls</span> <span class="op">=</span> <span class="nam">dns_links</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'access_urls'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t643" class="stm run hide_run">                <span class="nam">access_urls</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t644" class="stm run hide_run">                <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">responder</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'links'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t645" class="stm par run hide_run"><span class="annotate short">645&#x202F;&#x219B;&#x202F;646</span><span class="annotate long">line 645 didn't jump to line 646, because the condition on line 645 was never true</span>                    <span class="key">if</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">in</span> <span class="nam">removed_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t646" class="stm mis">                        <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t647" class="stm run hide_run">                    <span class="key">elif</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">in</span> <span class="nam">added_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t648" class="pln">                        <span class="com"># iterate through new access urls and get access url</span><span class="strut">&nbsp;</span></p>
<p id="t649" class="stm run hide_run">                        <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t650" class="stm par run hide_run"><span class="annotate short">650&#x202F;&#x219B;&#x202F;654</span><span class="annotate long">line 650 didn't jump to line 654, because the loop on line 650 didn't complete</span>                        <span class="key">for</span> <span class="nam">new_access_url</span> <span class="key">in</span> <span class="nam">new_access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t651" class="stm par run hide_run"><span class="annotate short">651&#x202F;&#x219B;&#x202F;650</span><span class="annotate long">line 651 didn't jump to line 650, because the condition on line 651 was never false</span>                            <span class="key">if</span> <span class="nam">new_access_url</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="op">==</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t652" class="stm run hide_run">                                <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">new_access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t653" class="stm run hide_run">                                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t654" class="stm run hide_run">                        <span class="nam">access_url</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t655" class="pln">                            <span class="str">'domain'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t656" class="pln">                            <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'href'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t657" class="pln">                            <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">operator_url</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t658" class="pln">                        <span class="com"># if it is a shared ssl access url, we need to store it</span><span class="strut">&nbsp;</span></p>
<p id="t659" class="stm par run hide_run"><span class="annotate short">659&#x202F;&#x219B;&#x202F;660</span><span class="annotate long">line 659 didn't jump to line 660, because the condition on line 659 was never true</span>                        <span class="key">if</span> <span class="nam">new_access_url</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'shared_ssl_flag'</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t660" class="stm mis">                            <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t661" class="stm run hide_run">                        <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t662" class="stm par run hide_run"><span class="annotate short">662&#x202F;&#x219B;&#x202F;644</span><span class="annotate long">line 662 didn't jump to line 644, because the condition on line 662 was never false</span>                    <span class="key">elif</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="key">in</span> <span class="nam">common_domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t663" class="pln">                        <span class="com"># iterate through old access urls and get access url</span><span class="strut">&nbsp;</span></p>
<p id="t664" class="stm run hide_run">                        <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t665" class="stm run hide_run">                        <span class="nam">old_access_url</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t666" class="stm par run hide_run"><span class="annotate short">666&#x202F;&#x219B;&#x202F;670</span><span class="annotate long">line 666 didn't jump to line 670, because the loop on line 666 didn't complete</span>                        <span class="key">for</span> <span class="nam">old_access_url</span> <span class="key">in</span> <span class="nam">old_access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t667" class="stm run hide_run">                            <span class="key">if</span> <span class="nam">old_access_url</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span> <span class="op">==</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t668" class="stm run hide_run">                                <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">old_access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t669" class="stm run hide_run">                                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t670" class="stm run hide_run">                        <span class="nam">access_url</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t671" class="pln">                            <span class="str">'domain'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t672" class="pln">                            <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'href'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t673" class="pln">                            <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">operator_url</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t674" class="pln">                        <span class="com"># if it is a shared ssl access url, we need to store it</span><span class="strut">&nbsp;</span></p>
<p id="t675" class="stm par run hide_run"><span class="annotate short">675&#x202F;&#x219B;&#x202F;676</span><span class="annotate long">line 675 didn't jump to line 676, because the condition on line 675 was never true</span>                        <span class="key">if</span> <span class="nam">old_access_url</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'shared_ssl_flag'</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t676" class="stm mis">                            <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t677" class="stm run hide_run">                        <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t678" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t679" class="pln">                <span class="com"># find upgraded domains and create placeholders for them</span><span class="strut">&nbsp;</span></p>
<p id="t680" class="stm run hide_run">                <span class="key">for</span> <span class="nam">domain</span> <span class="key">in</span> <span class="nam">service_updates</span><span class="op">.</span><span class="nam">domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t681" class="stm run hide_run">                    <span class="nam">is_upgrade</span> <span class="op">=</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t682" class="stm run hide_run">                    <span class="key">for</span> <span class="nam">old_domain</span> <span class="key">in</span> <span class="nam">service_old</span><span class="op">.</span><span class="nam">domains</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t683" class="stm run hide_run">                        <span class="key">if</span> <span class="nam">old_domain</span><span class="op">.</span><span class="nam">domain</span> <span class="op">==</span> <span class="nam">domain</span><span class="op">.</span><span class="nam">domain</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t684" class="stm par run hide_run"><span class="annotate short">684&#x202F;&#x219B;&#x202F;689</span><span class="annotate long">line 684 didn't jump to line 689</span>                            <span class="key">if</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t685" class="pln">                                <span class="nam">old_domain</span><span class="op">.</span><span class="nam">protocol</span> <span class="op">==</span> <span class="str">'http'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t686" class="pln">                                <span class="nam">domain</span><span class="op">.</span><span class="nam">protocol</span> <span class="op">==</span> <span class="str">'https'</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t687" class="pln">                                <span class="nam">domain</span><span class="op">.</span><span class="nam">certificate</span> <span class="op">==</span> <span class="str">'san'</span><span class="strut">&nbsp;</span></p>
<p id="t688" class="pln">                            <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t689" class="stm mis">                                <span class="nam">is_upgrade</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t690" class="stm mis">                                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t691" class="stm par run hide_run"><span class="annotate short">691&#x202F;&#x219B;&#x202F;692</span><span class="annotate long">line 691 didn't jump to line 692</span>                    <span class="key">if</span> <span class="nam">is_upgrade</span> <span class="key">is</span> <span class="nam">True</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t692" class="stm mis">                        <span class="nam">old_access_url_for_domain</span> <span class="op">=</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t693" class="pln">                            <span class="nam">service_old</span><span class="op">.</span><span class="nam">provider_details</span><span class="op">.</span><span class="nam">values</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="strut">&nbsp;</span></p>
<p id="t694" class="pln">                            <span class="nam">get_domain_access_url</span><span class="op">(</span><span class="nam">domain</span><span class="op">.</span><span class="nam">domain</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t695" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t696" class="pln">                        <span class="com"># add placeholder access url for upgraded domain</span><span class="strut">&nbsp;</span></p>
<p id="t697" class="pln">                        <span class="com"># the access_url dict here should be missing an entry</span><span class="strut">&nbsp;</span></p>
<p id="t698" class="pln">                        <span class="com"># for http san domain since provider url is</span><span class="strut">&nbsp;</span></p>
<p id="t699" class="pln">                        <span class="com"># determined only after an ssl cert is provisioned</span><span class="strut">&nbsp;</span></p>
<p id="t700" class="stm mis">                        <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t701" class="pln">                            <span class="str">'domain'</span><span class="op">:</span> <span class="nam">domain</span><span class="op">.</span><span class="nam">domain</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t702" class="pln">                            <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">None</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t703" class="pln">                            <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">None</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t704" class="pln">                            <span class="str">'old_operator_url'</span><span class="op">:</span> <span class="nam">old_access_url_for_domain</span><span class="op">[</span><span class="strut">&nbsp;</span></p>
<p id="t705" class="pln">                                <span class="str">'operator_url'</span><span class="strut">&nbsp;</span></p>
<p id="t706" class="pln">                            <span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t707" class="pln">                        <span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t708" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t709" class="pln">                <span class="com"># keep log_delivery urls intact when both old and new</span><span class="strut">&nbsp;</span></p>
<p id="t710" class="pln">                <span class="com"># services have log_delivery enabled</span><span class="strut">&nbsp;</span></p>
<p id="t711" class="stm run hide_run">                <span class="key">if</span> <span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t712" class="pln">                    <span class="nam">service_old</span><span class="op">.</span><span class="nam">log_delivery</span><span class="op">.</span><span class="nam">enabled</span> <span class="key">is</span> <span class="nam">True</span> <span class="key">and</span><span class="strut">&nbsp;</span></p>
<p id="t713" class="pln">                    <span class="nam">service_updates</span><span class="op">.</span><span class="nam">log_delivery</span><span class="op">.</span><span class="nam">enabled</span> <span class="key">is</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t714" class="pln">                <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t715" class="stm run hide_run">                    <span class="key">for</span> <span class="nam">old_access_url</span> <span class="key">in</span> <span class="nam">old_access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t716" class="stm run hide_run">                        <span class="key">if</span> <span class="str">'log_delivery'</span> <span class="key">in</span> <span class="nam">old_access_url</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t717" class="stm run hide_run">                            <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">old_access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t718" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t719" class="stm run hide_run">                <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="nam">access_urls</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t720" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t721" class="stm run hide_run">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">updated</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t722" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t723" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gather_cname_links</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">service_obj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t724" class="stm run hide_run">        <span class="nam">provider_details</span> <span class="op">=</span> <span class="nam">service_obj</span><span class="op">.</span><span class="nam">provider_details</span><span class="strut">&nbsp;</span></p>
<p id="t725" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t726" class="stm run hide_run">        <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t727" class="stm run hide_run">            <span class="nam">access_urls</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t728" class="stm run hide_run">            <span class="key">for</span> <span class="nam">link</span> <span class="key">in</span> <span class="nam">provider_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">.</span><span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t729" class="pln">                <span class="com"># if this is a log delivery URL, don't add</span><span class="strut">&nbsp;</span></p>
<p id="t730" class="stm run hide_run">                <span class="key">if</span> <span class="str">'log_delivery'</span> <span class="key">in</span> <span class="nam">link</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t731" class="stm run hide_run">                    <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t732" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t733" class="stm run hide_run">                <span class="nam">access_url</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t734" class="pln">                    <span class="str">'domain'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'domain'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t735" class="pln">                    <span class="str">'provider_url'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'provider_url'</span><span class="op">]</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t736" class="pln">                    <span class="str">'operator_url'</span><span class="op">:</span> <span class="nam">link</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t737" class="pln">                <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t738" class="pln">                <span class="com"># Need to indicate if this access_url is a shared ssl</span><span class="strut">&nbsp;</span></p>
<p id="t739" class="pln">                <span class="com"># access url, since its has different shard_prefix and</span><span class="strut">&nbsp;</span></p>
<p id="t740" class="pln">                <span class="com"># num_shard</span><span class="strut">&nbsp;</span></p>
<p id="t741" class="stm par run hide_run"><span class="annotate short">741&#x202F;&#x219B;&#x202F;742</span><span class="annotate long">line 741 didn't jump to line 742, because the condition on line 741 was never true</span>                <span class="key">if</span> <span class="nam">link</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">'shared_ssl_flag'</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t742" class="stm mis">                    <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t743" class="pln">                <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t744" class="stm run hide_run">                    <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t745" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t746" class="stm run hide_run">                <span class="nam">access_urls</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">access_url</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t747" class="stm run hide_run">            <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'access_urls'</span><span class="op">:</span> <span class="nam">access_urls</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t748" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t749" class="stm run hide_run">        <span class="key">return</span> <span class="nam">dns_details</span><span class="strut">&nbsp;</span></p>
<p id="t750" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t751" class="stm run hide_run">    <span class="key">def</span> <span class="nam">enable</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">service_obj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t752" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">gather_cname_links</span><span class="op">(</span><span class="nam">service_obj</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t753" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t754" class="stm par run hide_run"><span class="annotate short">754&#x202F;&#x219B;&#x202F;773</span><span class="annotate long">line 754 didn't jump to line 773, because the loop on line 754 didn't complete</span>            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">dns_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t755" class="stm run hide_run">                <span class="nam">access_urls</span> <span class="op">=</span> <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'access_urls'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t756" class="stm par run hide_run"><span class="annotate short">756&#x202F;&#x219B;&#x202F;754</span><span class="annotate long">line 756 didn't jump to line 754, because the loop on line 756 didn't complete</span>                <span class="key">for</span> <span class="nam">access_url</span> <span class="key">in</span> <span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t757" class="stm run hide_run">                    <span class="nam">provider_url</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="str">'provider_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t758" class="stm run hide_run">                    <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t759" class="stm run hide_run">                    <span class="nam">shared_ssl_flag</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t760" class="stm run hide_run">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_change_cname_record</span><span class="op">(</span><span class="nam">operator_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t761" class="pln">                                              <span class="nam">provider_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t762" class="pln">                                              <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t763" class="stm run hide_run">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t764" class="stm run hide_run">            <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">'Rackspace DNS Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t765" class="stm run hide_run">            <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t766" class="stm run hide_run">            <span class="nam">error</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t767" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t768" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">error_class</span><span class="strut">&nbsp;</span></p>
<p id="t769" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t770" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="nam">error_msg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t771" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">error</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t772" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t773" class="stm mis">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">updated</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t774" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t775" class="stm run hide_run">    <span class="key">def</span> <span class="nam">disable</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">service_obj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t776" class="stm run hide_run">        <span class="nam">dns_details</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">gather_cname_links</span><span class="op">(</span><span class="nam">service_obj</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t777" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t778" class="stm run hide_run">            <span class="nam">provider_url</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">url_404</span><span class="strut">&nbsp;</span></p>
<p id="t779" class="stm mis">            <span class="key">for</span> <span class="nam">provider_name</span> <span class="key">in</span> <span class="nam">dns_details</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t780" class="stm mis">                <span class="nam">access_urls</span> <span class="op">=</span> <span class="nam">dns_details</span><span class="op">[</span><span class="nam">provider_name</span><span class="op">]</span><span class="op">[</span><span class="str">'access_urls'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t781" class="stm mis">                <span class="key">for</span> <span class="nam">access_url</span> <span class="key">in</span> <span class="nam">access_urls</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t782" class="stm mis">                    <span class="nam">operator_url</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="str">'operator_url'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t783" class="stm mis">                    <span class="nam">shared_ssl_flag</span> <span class="op">=</span> <span class="nam">access_url</span><span class="op">[</span><span class="str">'shared_ssl_flag'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t784" class="stm mis">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_change_cname_record</span><span class="op">(</span><span class="nam">operator_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t785" class="pln">                                              <span class="nam">provider_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t786" class="pln">                                              <span class="nam">shared_ssl_flag</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t787" class="stm run hide_run">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t788" class="stm run hide_run">            <span class="nam">error_msg</span> <span class="op">=</span> <span class="str">'Rackspace DNS Exception: {0}'</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t789" class="stm run hide_run">            <span class="nam">error_class</span> <span class="op">=</span> <span class="nam">e</span><span class="op">.</span><span class="nam">__class__</span><span class="strut">&nbsp;</span></p>
<p id="t790" class="stm run hide_run">            <span class="nam">error</span> <span class="op">=</span> <span class="op">{</span><span class="strut">&nbsp;</span></p>
<p id="t791" class="pln">                <span class="str">'error_msg'</span><span class="op">:</span> <span class="nam">error_msg</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t792" class="pln">                <span class="str">'error_class'</span><span class="op">:</span> <span class="nam">error_class</span><span class="strut">&nbsp;</span></p>
<p id="t793" class="pln">            <span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t794" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="nam">error_msg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t795" class="stm run hide_run">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">failed</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">error</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t796" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t797" class="stm mis">            <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">responder</span><span class="op">.</span><span class="nam">updated</span><span class="op">(</span><span class="nam">dns_details</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t798" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t799" class="stm run hide_run">    <span class="key">def</span> <span class="nam">modify_cname</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">access_url</span><span class="op">,</span> <span class="nam">new_cert</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t800" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_change_cname_record</span><span class="op">(</span><span class="nam">access_url</span><span class="op">=</span><span class="nam">access_url</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t801" class="pln">                                  <span class="nam">target_url</span><span class="op">=</span><span class="nam">new_cert</span><span class="op">,</span> <span class="nam">shared_ssl_flag</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t802" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t803" class="stm run hide_run">    <span class="key">def</span> <span class="nam">is_shard_full</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">shard_name</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t804" class="stm run hide_run">        <span class="nam">count</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t805" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t806" class="stm run hide_run">            <span class="nam">shard_domain</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="nam">shard_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t807" class="stm run hide_run">        <span class="key">except</span> <span class="nam">exc</span><span class="op">.</span><span class="nam">NotFound</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t808" class="stm run hide_run">            <span class="nam">LOG</span><span class="op">.</span><span class="nam">error</span><span class="op">(</span><span class="str">"Shards not configured properly, could not find {0}."</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t809" class="stm run hide_run">            <span class="key">return</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t810" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t811" class="stm run hide_run">        <span class="nam">records</span> <span class="op">=</span> <span class="nam">shard_domain</span><span class="op">.</span><span class="nam">list_records</span><span class="op">(</span><span class="nam">limit</span><span class="op">=</span><span class="num">100</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t812" class="stm run hide_run">        <span class="nam">count</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t813" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t814" class="pln">        <span class="com"># Loop until all records are printed</span><span class="strut">&nbsp;</span></p>
<p id="t815" class="stm run hide_run">        <span class="key">while</span> <span class="nam">True</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t816" class="stm run hide_run">            <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t817" class="stm run hide_run">                <span class="nam">records</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">client</span><span class="op">.</span><span class="nam">list_records_next_page</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t818" class="stm run hide_run">                <span class="nam">count</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">records</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t819" class="stm run hide_run">            <span class="key">except</span> <span class="nam">exc</span><span class="op">.</span><span class="nam">NoMoreResults</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t820" class="stm run hide_run">                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t821" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t822" class="stm run hide_run">        <span class="nam">LOG</span><span class="op">.</span><span class="nam">info</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t823" class="pln">            <span class="str">"There were a total of {0} record(s) for {1}."</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t824" class="pln">                <span class="nam">count</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t825" class="pln">                <span class="nam">shard_name</span><span class="strut">&nbsp;</span></p>
<p id="t826" class="pln">            <span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t827" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t828" class="stm run hide_run">        <span class="key">if</span> <span class="nam">count</span> <span class="op">>=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_driver</span><span class="op">.</span><span class="nam">rackdns_conf</span><span class="op">.</span><span class="nam">records_limit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t829" class="stm run hide_run">            <span class="key">return</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t830" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t831" class="stm run hide_run">            <span class="key">return</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>

            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v4.2</a>,
            created at 2016-09-23 09:35
        </p>
    </div>
</div>

</body>
</html>
